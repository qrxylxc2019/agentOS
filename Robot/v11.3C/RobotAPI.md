# æœºå™¨äººåŸç”Ÿæ¥å£ä½¿ç”¨å‚è€ƒ

## RobotOS ç®€ä»‹

RobotOSæ˜¯çŒæˆ·æ˜Ÿç©ºåŸºäºå®‰å“å¹³å°å¼€å‘çš„é¢å‘å¤šå½¢æ€ç¡¬ä»¶æœºå™¨äººå’Œå¤šç§ä¸šåŠ¡åœºæ™¯ç»„åˆçš„å¼€æ”¾å¼å¼€å‘å¹³å°ã€‚

RobotOSæä¾›äº†ä¸°å¯Œçš„æœºå™¨äººä¸šåŠ¡APIã€æœºå™¨äººèƒ½åŠ›ç»„ä»¶ï¼Œä½¿å¼€å‘è€…å¯ä»¥æ–¹ä¾¿çš„å¼€å‘æœºå™¨äººåº”ç”¨ã€‚

RobotOSåŸºäºå®‰å“å¹³å°å¼€å‘ï¼ŒåŒæ—¶æä¾›äº†ä¸€å¥—é’ˆå¯¹android apkçš„sdkï¼Œç”¨æˆ·å¯ä»¥åº”ç”¨RobotService.jaråœ¨æœºå™¨äººä¸Šå¼€å‘androidåº”ç”¨ï¼Œè¿è¡ŒRobotOSçš„æœºå‹å‡æ”¯æŒè¯¥sdkã€‚

## ğŸš¨ é‡è¦ï¼šè¯­éŸ³åŠŸèƒ½è¿ç§»è¯´æ˜

**åœ¨AgentOSç³»ç»Ÿä¸Šï¼Œæ‰€æœ‰è¯­éŸ³å’ŒNLPç›¸å…³åŠŸèƒ½å·²è¿ç§»è‡³AgentOS SDKï¼ŒRobotAPIåŸæœ‰è¯­éŸ³å’ŒNLPåŠŸèƒ½å·²åœç”¨ï¼š**

### å·²åœç”¨çš„RobotAPIè¯­éŸ³å’ŒNLPåŠŸèƒ½
- **ASRï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰**ï¼šåŸRobotAPIçš„è¯­éŸ³è½¬æ–‡å­—åŠŸèƒ½
- **TTSï¼ˆè¯­éŸ³åˆæˆï¼‰**ï¼šåŸRobotAPIçš„æ–‡å­—è½¬è¯­éŸ³åŠŸèƒ½  
- **NLPï¼ˆè‡ªç„¶è¯­è¨€å¤„ç†ï¼‰**ï¼šåŸRobotAPIçš„è‡ªç„¶è¯­è¨€ç†è§£å’Œå¤„ç†åŠŸèƒ½

### æ–°çš„è¯­éŸ³å’Œå¤§æ¨¡å‹è§£å†³æ–¹æ¡ˆ
**æ‰€æœ‰è¯­éŸ³å’ŒNLPåŠŸèƒ½ç°å·²ç»Ÿä¸€ä½¿ç”¨AgentOS SDKæä¾›ï¼š**
- âœ… **å…å”¤é†’äº¤äº’**ï¼šAgentOS SDKæä¾›æ›´æ™ºèƒ½çš„å…å”¤é†’è¯­éŸ³äº¤äº’
- âœ… **ASR/TTS**ï¼šé€šè¿‡AgentOS SDKçš„`AgentCore.tts()`ç­‰æ¥å£å®ç°
- âœ… **æ™ºèƒ½å¯¹è¯**ï¼šé›†æˆå¤§æ¨¡å‹çš„è‡ªç„¶è¯­è¨€ç†è§£å’Œç”Ÿæˆï¼Œæ›¿ä»£åŸæœ‰NLPåŠŸèƒ½
- âœ… **Actionè§„åˆ’**ï¼šåŸºäºç”¨æˆ·è¯­éŸ³æ„å›¾è‡ªåŠ¨è§„åˆ’å’Œæ‰§è¡ŒåŠ¨ä½œ
- âœ… **å¤§æ¨¡å‹èƒ½åŠ›**ï¼šé€šè¿‡å¤§æ¨¡å‹å®ç°æ›´å¼ºå¤§çš„è‡ªç„¶è¯­è¨€ç†è§£ï¼Œæ›¿ä»£ä¼ ç»ŸNLP

### è¿ç§»æŒ‡å¼•
å¦‚æœæ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨äº†RobotAPIçš„è¯­éŸ³æˆ–NLPåŠŸèƒ½ï¼Œè¯·ï¼š
1. **ç§»é™¤RobotAPIç›¸å…³ä»£ç **ï¼šåˆ é™¤åŸæœ‰çš„ASRã€TTSã€NLPã€å”¤é†’ç­‰RobotAPIè°ƒç”¨
2. **é›†æˆAgentOS SDK**ï¼šå‚è€ƒ[AgentOS SDKæ–‡æ¡£](../../Agent/v0.3.5/AgentOS_SDK_Doc_v0.3.5.md)è¿›è¡Œé›†æˆ
3. **åŠŸèƒ½å¯¹ç…§è¿ç§»**ï¼š
   - RobotAPIå”¤é†’ â†’ AgentOS SDKå…å”¤é†’äº¤äº’
   - RobotAPI ASR â†’ AgentOS SDKè¯­éŸ³è¯†åˆ«ç›‘å¬
   - RobotAPI TTS â†’ AgentOS SDK `AgentCore.tts()`æ¥å£
   - RobotAPI NLP â†’ AgentOS SDKå¤§æ¨¡å‹æ¥å£å’ŒActionè§„åˆ’

### åä½œä½¿ç”¨
**RobotAPIä¸AgentOS SDKåä½œå…³ç³»ï¼š**
- **AgentOS SDK**ï¼šè´Ÿè´£æ‰€æœ‰AIæ™ºèƒ½äº¤äº’ï¼ˆè¯­éŸ³äº¤äº’ã€æ™ºèƒ½å¯¹è¯ã€å¤§æ¨¡å‹èƒ½åŠ›ã€Actionè§„åˆ’æ‰§è¡Œï¼‰
- **RobotAPI**ï¼šè´Ÿè´£æœºå™¨äººç¡¬ä»¶æ§åˆ¶ï¼ˆè¿åŠ¨ã€å¯¼èˆªã€ä¼ æ„Ÿå™¨ã€è§†è§‰ç­‰ï¼‰

**RobotAPIæ—§è¯­éŸ³åŠŸèƒ½å‚è€ƒæ–‡æ¡£**ï¼š
ä»¥ä¸‹æ–‡æ¡£å¸®åŠ©å¼€å‘è€…äº†è§£RobotAPIåŸæœ‰çš„è¯­éŸ³åŠŸèƒ½ï¼Œä¾¿äºè¯†åˆ«å’Œåˆ é™¤é¡¹ç›®ä¸­çš„æ—§ä»£ç ï¼š
- [è¯­éŸ³](https://orionbase.orionstar.com/doc?m=21&h=6065a29&lang=cn#text%E8%BD%ACmp3)

## ç‰ˆæœ¬

**V11.3 ç‰ˆæœ¬ API Latest**


## SDKæ¥å…¥

âš ï¸ **é‡è¦ï¼šRobot SDK åˆå§‹åŒ–çº¦æŸ**

**Robot SDK å¿…é¡»åœ¨ Application.onCreate() ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ˜¯å¼ºåˆ¶è¦æ±‚ï¼š**

- **åˆå§‹åŒ–æ—¶æœº**ï¼šå¿…é¡»åœ¨è‡ªå®šä¹‰ Application ç±»çš„ onCreate() æ–¹æ³•ä¸­è°ƒç”¨ `RobotApi.getInstance().connectServer()`

### 1. å¯¼å…¥SDKä¾èµ–

#### æ·»åŠ JARåŒ…ä¾èµ–
1. è·å–SDKæ–‡ä»¶ï¼šåœ¨Robotç‰ˆæœ¬ç›®å½•ä¸­æŸ¥æ‰¾ `robotservice_xx.jar` æ–‡ä»¶ï¼ˆå¦‚ `Robot/v11.3C/robotservice_11.3.jar`ï¼‰ã€‚SDKæ–‡ä»¶éµå¾ª `robotservice_<version>.jar` å‘½åè§„èŒƒï¼Œè¯·æ ¹æ®å®é™…ç‰ˆæœ¬é€‰æ‹©å¯¹åº”ç›®å½•
2. å°†JARåŒ…æ–‡ä»¶å¤åˆ¶åˆ°Androidé¡¹ç›®çš„ `app/libs/` ç›®å½•ä¸‹
3. åœ¨ `app/build.gradle` æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–é…ç½®ï¼š

```gradle
dependencies {
    implementation files('libs/robotservice_11.3.jar')
    // å…¶ä»–ä¾èµ–...
}
```

### 2. é…ç½®Manifestæ–‡ä»¶

åœ¨ `AndroidManifest.xml` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```xml
<activity android:name=".MainActivity">
    <intent-filter>
        <action android:name="android.intent.action.MAIN"/>
        <category android:name="android.intent.category.LAUNCHER"/>
    </intent-filter>
    <intent-filter>
        <action android:name="action.orionstar.default.app" />
        <category android:name="android.intent.category.DEFAULT" />
    </intent-filter>
</activity>
```

### 3. å¼€æœºå¯åŠ¨é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦åº”ç”¨åœ¨æœºå™¨äººå¼€æœºåè‡ªåŠ¨å¯åŠ¨ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤é…ç½®ï¼š

#### æ­¥éª¤1ï¼šManifesté…ç½®
åœ¨Activityä¸­æ·»åŠ ä»¥ä¸‹intent-filterï¼š

```xml
<intent-filter>
    <action android:name="action.orionstar.default.app" />
    <category android:name="android.intent.category.DEFAULT" />
</intent-filter>
```

#### æ­¥éª¤2ï¼šç³»ç»Ÿè®¾ç½®
åœ¨æœºå™¨äººç³»ç»Ÿä¸­è¿›è¡Œè®¾ç½®ï¼š
1. ä¸‰æŒ‡ä¸‹æ‹‰è¿›å…¥ç³»ç»Ÿè®¾ç½®
2. é€‰æ‹©"å¼€å‘è€…è®¾ç½®"
3. åœ¨"å¼€æœºå¯åŠ¨ç¨‹åº"ä¸­é…ç½®æ‚¨çš„åº”ç”¨

> **é‡è¦æç¤º**ï¼šå¼€æœºå¯åŠ¨ç¨‹åºè®¾ç½®åŠŸèƒ½éœ€è¦OTA3åŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ

### 4. æƒé™é…ç½®

ä¸ºäº†ç¡®ä¿SDKåŠŸèƒ½æ­£å¸¸è¿è¡Œï¼Œéœ€è¦åœ¨ `AndroidManifest.xml` ä¸­å£°æ˜ä»¥ä¸‹æƒé™ï¼š

```xml
<!-- ç½‘ç»œè®¿é—®æƒé™ -->
<uses-permission android:name="android.permission.INTERNET"/>
<!-- æœºå™¨äººè®¾ç½®æä¾›è€…æƒé™ -->
<uses-permission android:name="com.ainirobot.coreservice.robotSettingProvider" />
<!-- å¤–éƒ¨å­˜å‚¨è¯»å†™æƒé™ -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/>
```

## SDKæ¥å…¥æ­¥éª¤

âš ï¸ **å…³é”®æé†’ï¼šä»¥ä¸‹æ‰€æœ‰æ­¥éª¤å¿…é¡»åœ¨è‡ªå®šä¹‰ Application ç±»çš„ onCreate() æ–¹æ³•ä¸­æ‰§è¡Œ**

### 1. åˆ›å»ºå›è°ƒæ¥å£

åˆ›å»ºæ¥æ”¶è¯­éŸ³è¯·æ±‚åŠç³»ç»Ÿäº‹ä»¶çš„å›è°ƒï¼š

```java
public class ModuleCallback extends ModuleCallbackApi {
    @Override
    public boolean onSendRequest(int reqId, String reqType, String reqText, String reqParam)
            throws RemoteException {
                //è¿™ä¸ªå›è°ƒåºŸå¼ƒ
        return true;
    }
    
    @Override 
    public void onRecovery() throws RemoteException {
        // æ§åˆ¶æƒæ¢å¤ï¼Œæ”¶åˆ°è¯¥äº‹ä»¶åï¼Œé‡æ–°æ¢å¤å¯¹æœºå™¨äººçš„æ§åˆ¶
    }
    
    @Override 
    public void onSuspend() throws RemoteException {
        // æ§åˆ¶æƒè¢«ç³»ç»Ÿå‰¥å¤ºï¼Œæ”¶åˆ°è¯¥äº‹ä»¶åï¼Œæ‰€æœ‰Apiè°ƒç”¨æ— æ•ˆ
    }
}
```

### 2. è¿æ¥æœåŠ¡å™¨

```java
RobotApi.getInstance().connectServer(this, new ApiListener() {
    @Override
    public void handleApiDisabled() {
        // APIå·²ç¦ç”¨
    }
    
    @Override
    public void handleApiConnected() {
        // Serverå·²è¿æ¥ï¼Œè®¾ç½®æ¥æ”¶è¯·æ±‚çš„å›è°ƒï¼ŒåŒ…å«è¯­éŸ³æŒ‡ä»¤ã€ç³»ç»Ÿäº‹ä»¶ç­‰

    }
    
    @Override
    public void handleApiDisconnected() {
        // è¿æ¥å·²æ–­å¼€
    }
});
```

**é‡è¦è¯´æ˜ï¼š**
æœºå™¨äººSDKçš„åˆå§‹åŒ–ï¼Œæ ‡å¿—ç€æœºå™¨äººæŠŠåº•ç›˜èƒ½åŠ›æƒé™ç§»äº¤ç»™äº†å½“å‰æ­£åœ¨è¿è¡Œçš„APPã€‚æœºå™¨äººä¼šåœ¨ç³»ç»Ÿæ¥ç®¡ã€å‘ç”Ÿæ•…éšœã€å¯åŠ¨äº†å…¶å®ƒå¸¦æœºå™¨äººSDKç¨‹åºçš„æ—¶å€™å‘ç”Ÿè¿æ¥å·²æ–­å¼€çš„å›è°ƒã€‚å…¶ä¸­åªæœ‰ç³»ç»Ÿæ¥ç®¡ç»“æŸæ—¶ï¼Œä¼šé‡æ–°connectä¸Šã€‚

> **æ³¨æ„1**ï¼šæ‰€æœ‰Apiå¿…é¡»åœ¨è¿æ¥serveræˆåŠŸä¹‹åæ‰èƒ½å¤Ÿè°ƒç”¨
> 
> **æ³¨æ„2**ï¼šåªæœ‰å‰å°è¿›ç¨‹ï¼Œåœ¨å‰å°è¿è¡Œæ—¶èƒ½æ­£ç¡®çš„è¿æ¥å¹¶è·å–æœºå™¨äººåº•ç›˜æ§åˆ¶æƒé™ï¼ŒæœåŠ¡è¿›ç¨‹ä¸å·¥ä½œã€‚
> 
> **æ³¨æ„3**ï¼šâš ï¸ **å¼ºåˆ¶è¦æ±‚** - æ­¤è¿æ¥æ“ä½œå¿…é¡»åœ¨ Application.onCreate() ä¸­æ‰§è¡Œï¼Œä¸å¾—åœ¨å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æˆ–ç»„ä»¶ä¸­åˆå§‹åŒ–



### 5. æ³¨å†ŒçŠ¶æ€ç›‘å¬

```java
StatusListener statusListener = new StatusListener(){
    @Override
    public void onStatusUpdate(String type, String data) throws RemoteException {
        // å¤„ç†çŠ¶æ€æ›´æ–°
    }
};

// æ³¨å†ŒçŠ¶æ€ç›‘å¬
RobotApi.getInstance().registerStatusListener(type, statusListener);

// è§£é™¤çŠ¶æ€ç›‘å¬
RobotApi.getInstance().unregisterStatusListener(statusListener);
```

**æ”¯æŒçš„çŠ¶æ€ç±»å‹ï¼š**

- `Definition.STATUS_POSE`ï¼šæœºå™¨äººå½“å‰çš„åæ ‡ï¼ŒæŒç»­ä¸ŠæŠ¥
- `Definition.STATUS_POSE_ESTIMATE`ï¼šå½“å‰å®šä½çŠ¶æ€ï¼Œå®šä½çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ä¸ŠæŠ¥
- `Definition.STATUS_BATTERY`ï¼šå½“å‰ç”µæ± çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ˜¯å¦åœ¨å……ç”µã€ç”µé‡å¤šå°‘ã€æ˜¯å¦ä½ç”µé‡æŠ¥è­¦ç­‰

### 6. è®¾ç½®reqId

å¾ˆå¤šSDKçš„æ–¹æ³•éœ€è¦ä¼ å…¥å‚æ•° `reqId`ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºè°ƒè¯•ã€è·Ÿè¸ªæ—¥å¿—çš„idã€‚ä¼ å…¥ä»»ä½•æ•°å­—éƒ½èƒ½è®©å‡½æ•°æ­£å¸¸å·¥ä½œï¼Œä½†ä¸ºäº†æ—¥å¿—è¿½è¸ªã€è°ƒè¯•çš„æ–¹ä¾¿ï¼Œå»ºè®®æŠŠ `reqId` åšæˆä¸€ä¸ªè‡ªå¢é•¿çš„staticå˜é‡ï¼Œæˆ–è€…æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œä¼ å…¥ä¸åŒçš„ `reqId` æ¥åšè°ƒç”¨å‡½æ•°çš„åŒºåˆ†ã€‚

## æœºå™¨äººèƒ½åŠ›ç»„åˆ

### ç®€ä»‹

æœºå™¨äººçš„å¾ˆå¤šé«˜çº§åŠŸèƒ½éœ€è¦å°†å¤šä¸ªåŸºç¡€APIç»„åˆä½¿ç”¨æ‰èƒ½å®ç°ã€‚æœ¬ç« èŠ‚ä»‹ç»ä¸€äº›å¸¸ç”¨çš„èƒ½åŠ›ç»„åˆæµç¨‹ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿç†è§£å¦‚ä½•ç»„åˆä½¿ç”¨å„ç§APIå®ç°å¤æ‚åŠŸèƒ½ã€‚

### äººè„¸è¯†åˆ«å®Œæ•´æµç¨‹

äººè„¸è¯†åˆ«æ˜¯æœºå™¨äººçš„ä¸€ä¸ªé‡è¦èƒ½åŠ›ï¼Œéœ€è¦å°†äººå‘˜æ£€æµ‹ã€æœ€ä½³äººè„¸ç­›é€‰ã€ç…§ç‰‡è·å–å’Œç½‘ç»œè¯†åˆ«ç­‰å¤šä¸ªæ­¥éª¤ç»„åˆä½¿ç”¨ã€‚

**å®ç°æµç¨‹ï¼š**

1. **è·å–å®Œæ•´äººè„¸åˆ—è¡¨**ï¼šä»æœºå™¨äººè§†è§‰ä¸­è·å–æ‰€æœ‰æ£€æµ‹åˆ°çš„å®Œæ•´äººè„¸ä¿¡æ¯
2. **ç­›é€‰æœ€ä½³äººè„¸**ï¼šä»äººè„¸åˆ—è¡¨ä¸­é€‰æ‹©è´¨é‡æœ€å¥½çš„äººè„¸è¿›è¡Œè¯†åˆ«
3. **è·å–äººè„¸ç…§ç‰‡**ï¼šé€šè¿‡äººè„¸IDè·å–æœ¬åœ°ç…§ç‰‡è·¯å¾„
4. **æ‰§è¡Œç½‘ç»œè¯†åˆ«**ï¼šå°†ç…§ç‰‡ä¸Šä¼ åˆ°æœåŠ¡å™¨è¿›è¡Œäººè„¸è¯†åˆ«
5. **å¤„ç†è¯†åˆ«ç»“æœ**ï¼šæ ¹æ®è¿”å›ç»“æœåˆ¤æ–­è¯†åˆ«æ˜¯å¦æˆåŠŸ

**å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š**

```java
/**
 * äººè„¸è¯†åˆ«å®Œæ•´æµç¨‹å®ç°
 */
public void performFaceRecognition() {
    // æ­¥éª¤1ï¼šè·å–å®Œæ•´äººè„¸åˆ—è¡¨
    List<Person> completeFaceList = PersonApi.getInstance().getCompleteFaceList();
    
    if (completeFaceList == null || completeFaceList.isEmpty()) {
        Log.d(TAG, "æœªæ£€æµ‹åˆ°å®Œæ•´äººè„¸");
        return;
    }
    
    // æ­¥éª¤2ï¼šç­›é€‰æœ€ä½³äººè„¸
    Person bestPerson = PersonUtils.getBestFace(
        completeFaceList,
        3.0,  // æœ€å¤§è·ç¦»ï¼Œå•ä½ç±³
        60.0  // äººè„¸è§’åº¦é˜ˆå€¼ï¼Œå•ä½åº¦
    );
    
    if (bestPerson == null) {
        Log.d(TAG, "æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æœ€ä½³äººè„¸");
        return;
    }
    
    int faceId = bestPerson.getId();
    Log.d(TAG, "é€‰æ‹©çš„æœ€ä½³äººè„¸ID: " + faceId);
    
    // æ­¥éª¤3ï¼šè·å–äººè„¸ç…§ç‰‡
    RobotApi.getInstance().getPictureById(reqId, faceId, 1, new CommandListener() {
        @Override
        public void onResult(int result, String message) {
            try {
                JSONObject json = new JSONObject(message);
                String status = json.optString("status");
                
                if (Definition.RESPONSE_OK.equals(status)) {
                    JSONArray pictures = json.optJSONArray("pictures");
                    if (pictures != null && pictures.length() > 0) {
                        String picturePath = pictures.optString(0);
                        Log.d(TAG, "è·å–äººè„¸ç…§ç‰‡æˆåŠŸ: " + picturePath);
                        
                        // æ­¥éª¤4ï¼šæ‰§è¡Œç½‘ç»œè¯†åˆ«
                        performNetworkRecognition(faceId, picturePath);
                    } else {
                        Log.e(TAG, "è·å–äººè„¸ç…§ç‰‡å¤±è´¥ï¼šç…§ç‰‡æ•°ç»„ä¸ºç©º");
                    }
                } else {
                    Log.e(TAG, "è·å–äººè„¸ç…§ç‰‡å¤±è´¥ï¼š" + message);
                }
            } catch (JSONException e) {
                Log.e(TAG, "è§£æç…§ç‰‡ç»“æœå¤±è´¥", e);
            }
        }
    });
}

/**
 * æ‰§è¡Œç½‘ç»œäººè„¸è¯†åˆ«
 */
private void performNetworkRecognition(int faceId, String picturePath) {
    // æ­¥éª¤4ï¼šç½‘ç»œè¯†åˆ«
    RobotApi.getInstance().getPersonInfoFromNet(reqId, faceId, picturePath, new CommandListener() {
        @Override
        public void onResult(int result, String message) {
            try {
                JSONObject json = new JSONObject(message);
                
                // æ£€æŸ¥å®é™…çš„å“åº”ç»“æ„ï¼šdata.people
                if (json.has("data")) {
                    JSONObject dataObj = json.getJSONObject("data");
                    if (dataObj.has("people")) {
                        // æ­¥éª¤5ï¼šå¤„ç†è¯†åˆ«æˆåŠŸç»“æœ
                        JSONObject peopleInfo = dataObj.getJSONObject("people");
                        String name = peopleInfo.optString("name", "æœªçŸ¥");
                        String identity = peopleInfo.optString("identity", "æœªçŸ¥");
                        boolean isStaff = peopleInfo.optInt("is_staff", 0) == 1;
                        
                        Log.d(TAG, "äººè„¸è¯†åˆ«æˆåŠŸ - å§“å: " + name + ", èº«ä»½: " + identity + ", æ˜¯å¦å‘˜å·¥: " + isStaff);
                        // è¿™é‡Œå¤„ç†è¯†åˆ«æˆåŠŸçš„ä¸šåŠ¡é€»è¾‘
                        
                    } else {
                        Log.d(TAG, "è¯†åˆ«å¤±è´¥ï¼šdataä¸­æ— peopleå­—æ®µ");
                        // è¿™é‡Œå¤„ç†è¯†åˆ«å¤±è´¥çš„ä¸šåŠ¡é€»è¾‘
                    }
                } else {
                    // è¯†åˆ«å¤±è´¥æˆ–æœªæ‰¾åˆ°åŒ¹é…çš„äººè„¸
                    Log.d(TAG, "äººè„¸è¯†åˆ«å¤±è´¥ï¼šå“åº”ä¸­æ— dataå­—æ®µ");
                    // è¿™é‡Œå¤„ç†è¯†åˆ«å¤±è´¥çš„ä¸šåŠ¡é€»è¾‘
                }
                
            } catch (JSONException e) {
                Log.e(TAG, "è§£æè¯†åˆ«ç»“æœå¤±è´¥", e);
                // è¿™é‡Œå¤„ç†è§£æå¼‚å¸¸çš„ä¸šåŠ¡é€»è¾‘
            }
        }
    });
}


```

**å…³é”®è¦ç‚¹ï¼š**

1. **å¼‚æ­¥å¤„ç†**ï¼šæ‰€æœ‰ç½‘ç»œç›¸å…³æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦åœ¨å›è°ƒä¸­å¤„ç†ç»“æœ
2. **é”™è¯¯å¤„ç†**ï¼šæ¯ä¸ªæ­¥éª¤éƒ½åº”è¯¥æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†æœºåˆ¶
3. **èµ„æºæ¸…ç†**ï¼šè·å–çš„å›¾ç‰‡æ–‡ä»¶ä½¿ç”¨å®Œåéœ€è¦æ‰‹åŠ¨åˆ é™¤ï¼Œé¿å…å ç”¨å­˜å‚¨ç©ºé—´
4. **å‚æ•°ä¼˜åŒ–**ï¼š`PersonUtils.getBestFace`çš„è·ç¦»å’Œè§’åº¦å‚æ•°éœ€è¦æ ¹æ®å®é™…åœºæ™¯è°ƒæ•´
5. **æ€§èƒ½è€ƒè™‘**ï¼šäººè„¸è¯†åˆ«æ˜¯è®¡ç®—å¯†é›†å‹æ“ä½œï¼Œå»ºè®®åœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œ

**é€‚ç”¨åœºæ™¯ï¼š**

- è®¿å®¢èº«ä»½éªŒè¯
- å‘˜å·¥è€ƒå‹¤ç³»ç»Ÿ
- ä¸ªæ€§åŒ–æœåŠ¡æ¨è
- å®‰å…¨ç›‘æ§ç³»ç»Ÿ

## è§†è§‰èƒ½åŠ›

### ç®€ä»‹

è§†è§‰èƒ½åŠ›ç›®å‰ä¸»è¦æŒ‡äººå‘˜æ£€æµ‹å’Œè¯†åˆ«ä¸¤ä¸ªæ¨¡å—ï¼ŒApiæä¾›ä¸»è¦é›†ä¸­åœ¨PersonApiå’ŒRobotApiã€‚

äººå‘˜ä¿¡æ¯æ£€æµ‹æ˜¯æœ¬åœ°èƒ½åŠ›ï¼Œäººç«™åœ¨æœºå™¨äººå‰æ–¹ï¼ˆæ’é™¤å…‰çº¿è¾ƒå·®çš„æƒ…å†µï¼‰ï¼Œæœºå™¨äººå¯ä»¥æ£€æµ‹åˆ°å‰æ–¹äººå‘˜ï¼Œäººç«™çš„è¾ƒè¿œæ—¶äººè„¸å’Œäººä½“å‡å¯æ£€æµ‹åˆ°ï¼Œäººç«™çš„æ¯”è¾ƒè¿‘çš„æ—¶å€™åªèƒ½æ£€æµ‹åˆ°äººè„¸ä¿¡æ¯ã€‚å½“äººå‘˜idå¤§äºç­‰äº0æ—¶ï¼Œä»£è¡¨ç€è¯¥äººå‘˜çš„äººè„¸ä¿¡æ¯å®Œæ•´ï¼Œå¯ä»¥è·å–åˆ°è¯¥äººäººè„¸ç…§ç‰‡è¿›è¡Œè¯†åˆ«ã€‚

äººå‘˜è¯†åˆ«éœ€è¦ä½¿ç”¨äººè„¸ç…§ç‰‡è¿›è¡Œè¯†åˆ«ï¼Œè¯¥èƒ½åŠ›éœ€è¦ä½¿ç”¨ç½‘ç»œï¼Œè¯·æ³¨æ„è·å–äººå‘˜ç…§ç‰‡æ—¶ï¼Œä¿è¯äººå‘˜ç¬¦åˆé‡‡å–ç…§ç‰‡æ¡ä»¶ã€‚

> **æ³¨æ„**ï¼šä½¿ç”¨æœºå™¨äººè§†è§‰èƒ½åŠ›çš„æ—¶å€™ï¼Œä¸å¯ä»¥åŒæ—¶ä½¿ç”¨æœºå™¨äººæ‘„åƒå¤´ã€‚è¿™å°†ä¼šå¯¼è‡´è§†è§‰èƒ½åŠ›æŠ¥é”™å¤±æ•ˆ

å…·ä½“ä½¿ç”¨æµç¨‹è¯¦è§Demoï¼Œä¸‹é¢ä¸ºAPIä»‹ç»ï¼š

### Personä¸»è¦ä¿¡æ¯

```java
private int id; //äººè„¸æœ¬åœ°è¯†åˆ«idï¼Œæ­¤idå¯ç”¨äºç„¦ç‚¹è·Ÿéšç­‰ã€‚
private double distance; //è·ç¦»
private double faceAngleX; //äººè„¸xè½´è§’åº¦
private double faceAngleY; //äººè„¸yè½´è§’åº¦
private int headSpeed; //å½“å‰æœºå™¨äººå¤´éƒ¨è½¬åŠ¨é€Ÿåº¦
private long latency; //æ•°æ®å»¶è¿Ÿ
private int facewidth; //äººè„¸å®½åº¦
private int faceheight; //äººè„¸é«˜åº¦
private int faceX; //äººè„¸xåæ ‡
private int faceY; //äººè„¸yåæ ‡
private int bodyX; //èº«ä½“xåæ ‡
private int bodyY; //èº«ä½“yåæ ‡
private int bodywidth; //èº«ä½“å®½åº¦
private int bodyheight; //èº«ä½“é«˜åº¦
private double angleInView; //äººç›¸å¯¹äºæœºå™¨äººå¤´éƒ¨çš„è§’åº¦
private String quality; //æ£€æŸ¥è´¨é‡å‚æ•°
private int age; //å¹´é¾„ï¼ˆäº‘ç«¯æ³¨å†Œåä¼šè¿”å›ä¼°ç®—å€¼ï¼‰
private String gender; //æ€§åˆ«ï¼ˆæŒ‰ç…§å›½å®¶è§„å®šï¼Œæ­¤é¡¹å¿…é¡»æˆæƒæ³¨å†Œåæ‰ä¼šè¿”å›ç»“æœï¼‰
private int glasses; //æ˜¯å¦æˆ´çœ¼ç›
private String remoteFaceId; //å¦‚æœå·²æ³¨å†Œï¼Œæ³¨å†Œçš„äººè„¸è¿œç«¯id
private String faceRegisterTime; //æ³¨å†Œæ—¶é—´
//æ›´å¤šPersonä¿¡æ¯ï¼Œå¯å‚è§SDKä¸­com.ainirobot.coreservice.client.listener.Personç±»å®šä¹‰
```
### æ³¨å†Œäººå‘˜å˜åŒ–ç›‘å¬

**æ–¹æ³•åç§°ï¼š** `registerPersonListener` / `unregisterPersonListener`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
PersonListener listener = new PersonListener() {
    @Override
    public void personChanged() {
        super.personChanged();
        //äººå‘˜å˜åŒ–æ—¶ï¼Œå¯ä»¥è°ƒç”¨è·å–å½“å‰äººå‘˜åˆ—è¡¨æ¥å£è·å–æœºå™¨äººè§†é‡å†…æ‰€æœ‰äººå‘˜
    }
};

//æ³¨å†Œäººå‘˜ç›‘å¬
PersonApi.getInstance().registerPersonListener(listener);

//å–æ¶ˆæ³¨å†Œäººå‘˜ç›‘å¬
PersonApi.getInstance().unregisterPersonListener(listener);
```

**å‚æ•°è¯´æ˜ï¼š**

- `listener`ï¼šäººå‘˜ä¿¡æ¯å˜åŒ–ç›‘å¬
### è·å–å…¨éƒ¨äººå‘˜ä¿¡æ¯

**æ–¹æ³•åç§°ï¼š** `getAllPersons`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
//è·å–æœºå™¨äººè§†é‡å†…å…¨éƒ¨äººå‘˜ä¿¡æ¯
List<Person> personList = PersonApi.getInstance().getAllPersons();
//è·å–æœºå™¨äººè§†é‡å†…1mèŒƒå›´å†…æ‰€æœ‰çš„äººå‘˜ä¿¡æ¯
List personList = PersonApi.getInstance().getAllPersons(1);
```

**å‚æ•°è¯´æ˜ï¼š**

- `maxDistance`ï¼šæœºå™¨äººå¤šå¤§è§†é‡èŒƒå›´å†…ï¼Œå•ä½ä¸ºç±³ï¼Œæœºå™¨äººèƒ½è¯†åˆ«æœ€å‡†ç¡®çš„äººå‘˜è·ç¦»æ˜¯1-3ç±³ã€‚

**è¿”å›ï¼š**

- `personList`ï¼šäººå‘˜ä¿¡æ¯åˆ—è¡¨
### è·å–æ£€æµ‹åˆ°äººä½“çš„äººå‘˜åˆ—è¡¨

**æ–¹æ³•åç§°ï¼š** `getAllBodyList`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
//è·å–æœºå™¨äººè§†é‡å†…æ‰€æœ‰äººä½“ä¿¡æ¯çš„äººå‘˜åˆ—è¡¨
List<Person> personList = PersonApi.getInstance().getAllBodyList();
//è·å–æœºå™¨äººè§†é‡å†…1mèŒƒå›´å†…æ‰€æœ‰çš„äººä½“ä¿¡æ¯çš„äººå‘˜åˆ—è¡¨
List personList = PersonApi.getInstance().getAllBodyList(1);
```

**å‚æ•°è¯´æ˜ï¼š**

- `maxDistance`ï¼šæœºå™¨äººå¤šå¤§è§†é‡èŒƒå›´å†…ï¼Œå•ä½ä¸ºç±³ï¼Œæœºå™¨äººèƒ½è¯†åˆ«æœ€å‡†ç¡®çš„äººå‘˜è·ç¦»æ˜¯1-3ç±³ã€‚

**è¿”å›ï¼š**

- `personList`ï¼šäººå‘˜ä¿¡æ¯åˆ—è¡¨

### è·å–æ£€æµ‹åˆ°äººè„¸çš„äººå‘˜åˆ—è¡¨

**æ–¹æ³•åç§°ï¼š** `getAllFaceList`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
//è·å–æœºå™¨äººè§†é‡å†…æ‰€æœ‰æœ‰äººè„¸ä¿¡æ¯çš„äººå‘˜åˆ—è¡¨
List<Person> personList = PersonApi.getInstance().getAllFaceList();
//è·å–æœºå™¨äººè§†é‡å†…1mèŒƒå›´å†…æ‰€æœ‰æœ‰äººè„¸ä¿¡æ¯çš„äººå‘˜åˆ—è¡¨
List personList = PersonApi.getInstance().getAllFaceList(1);
```

**å‚æ•°è¯´æ˜ï¼š**

- `maxDistance`ï¼šæœºå™¨äººå¤šå¤§è§†é‡èŒƒå›´å†…ï¼Œå•ä½ä¸ºç±³ï¼Œæœºå™¨äººèƒ½è¯†åˆ«æœ€å‡†ç¡®çš„äººå‘˜è·ç¦»æ˜¯1-3ç±³ã€‚

**è¿”å›ï¼š**

- `personList`ï¼šäººå‘˜ä¿¡æ¯åˆ—è¡¨

### è·å–æ£€æµ‹åˆ°å®Œæ•´äººè„¸çš„äººå‘˜åˆ—è¡¨

**æ–¹æ³•åç§°ï¼š** `getCompleteFaceList`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
//è·å–æœºå™¨äººè§†é‡å†…æ‰€æœ‰æœ‰å®Œæ•´äººè„¸ä¿¡æ¯çš„äººå‘˜åˆ—è¡¨
List<Person> personList = PersonApi.getInstance().getCompleteFaceList();
```

**è¿”å›ï¼š**

- `personList`ï¼šäººå‘˜ä¿¡æ¯åˆ—è¡¨

### è·å–æœ€ä½³äººè„¸

**æ–¹æ³•åç§°ï¼š** `PersonUtils.getBestFace`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
// ä»å®Œæ•´äººè„¸åˆ—è¡¨ä¸­è·å–æœ€ä½³äººè„¸
Person bestPerson = PersonUtils.getBestFace(
    PersonApi.getInstance().getCompleteFaceList(),
    3.0,  // æœ€å¤§è·ç¦»ï¼Œå•ä½ç±³
    60.0  // äººè„¸è§’åº¦é˜ˆå€¼ï¼Œå•ä½åº¦
);
```

**å‚æ•°è¯´æ˜ï¼š**

- `completeFaceList`ï¼šå®Œæ•´äººè„¸çš„äººå‘˜åˆ—è¡¨
- `maxDistance`ï¼šæœ€å¤§è·ç¦»é™åˆ¶ï¼Œè¶…è¿‡æ­¤è·ç¦»çš„äººè„¸ä¸å‚ä¸ç­›é€‰ï¼Œå•ä½ç±³
- `angleThreshold`ï¼šäººè„¸è§’åº¦é˜ˆå€¼ï¼Œç”¨äºç­›é€‰æ­£é¢è§’åº¦çš„äººè„¸ï¼Œå•ä½åº¦

**è¿”å›ï¼š**

- `bestPerson`ï¼šç­›é€‰å‡ºçš„æœ€ä½³äººè„¸ï¼Œå¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„äººè„¸åˆ™è¿”å›null

### è·å–æ­£åœ¨ç„¦ç‚¹è·Ÿéšçš„äººå‘˜

æ­¤æ–¹æ³•ä»…åœ¨ç„¦ç‚¹è·Ÿéšè¿›è¡Œä¸­æœ‰æ•ˆ

**æ–¹æ³•åç§°ï¼š** `getFocusPerson`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
Person person = PersonApi.getInstance().getFocusPerson();
```

**è¿”å›ï¼š**

- `person`ï¼šäººå‘˜ä¿¡æ¯

ç„¦ç‚¹è·Ÿéšç›¸å…³APIï¼Œç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚

### è·å–äººè„¸ç…§ç‰‡

**æ–¹æ³•åç§°ï¼š** `getPictureById`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().getPictureById(reqId, faceId, count, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        try {
            JSONObject json = new JSONObject(message);
            String status = json.optString("status");
            //è·å–ç…§ç‰‡æˆåŠŸ
            if (Definition.RESPONSE_OK.equals(status)) {
                JSONArray pictures = json.optJSONArray("pictures");
                if (!TextUtils.isEmpty(pictures.optString(0))) {
                    //ç…§ç‰‡æœ¬åœ°å­˜å‚¨å…¨è·¯å¾„
                    String picturePath = pictures.optString(0);
                }
            }
        } catch (JSONException | NullPointerException e) {
            e.printStackTrace();
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `faceID`ï¼šäººè„¸idï¼Œå¯é€šè¿‡æœ¬åœ°äººè„¸è¯†åˆ«è·å¾—ï¼ˆPersonçš„idï¼‰
- `count`ï¼šéœ€è¦è·å–çš„ç…§ç‰‡æ•°é‡ï¼Œæ­¤å‚æ•°ç›®å‰æ— æ•ˆï¼Œé»˜è®¤åªæœ‰ä¸€å¼ 

> **æ³¨æ„**ï¼šè¯¥æ¥å£ä¿å­˜çš„å›¾ç‰‡åœ¨ä½¿ç”¨å®Œåéœ€è¦æ‰‹åŠ¨åˆ é™¤

### è‡ªåŠ¨æ³¨å†Œ

**æ–¹æ³•åç§°ï¼š** `startRegister`

ä¼ å…¥å§“åï¼Œè¯¥æ–¹æ³•ä¼šå®æ—¶ä»æ‘„åƒå¤´ä¸­è·å–äººè„¸ï¼Œå°†è¯¥äººè„¸æ³¨å†Œä¸ºè¯¥å§“åã€‚æ—¥å¸¸ä½¿ç”¨è¯¥æ–¹å¼æ³¨å†Œäººè„¸

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().startRegister(reqId, personName, timeout, tryCount, secondDelay, new ActionListener() {
    @Override
    public void onResult(int status, String response) throws RemoteException {
        if (Definition.RESULT_OK != status) {
            //æ³¨å†Œå¤±è´¥
            return;
        }
        try {
            JSONObject json = new JSONObject(response);
            String remoteType = json.optString(Definition.REGISTER_REMOTE_TYPE);
            String remoteName = json.optString(Definition.REGISTER_REMOTE_NAME);
            if (Definition.REGISTER_REMOTE_SERVER_EXIST.equals(remoteType)) {
                //å½“å‰ç”¨æˆ·å·²å­˜åœ¨
            } else if (Definition.REGISTER_REMOTE_SERVER_NEW.equals(remoteType)) {
                //æ–°æ³¨å†Œç”¨æˆ·æˆåŠŸ
            }
        } catch (JSONException e) {
            e.printStackTrace();
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `personName`ï¼šæ³¨å†Œåç§°
- `timeout`ï¼šæ³¨å†Œè¶…æ—¶æ—¶é—´ï¼Œæ³¨å†Œå¤±è´¥æ—¶ä¼šå°è¯•é‡æ–°æ³¨å†Œï¼Œç›´åˆ°è¶…æ—¶
- `tryCount`ï¼šå¤±è´¥é‡è¯•æ¬¡æ•°ï¼Œé‡è¯•çš„æ—¶é—´å¤§äºtimeoutåï¼Œä¼šæ”¾å¼ƒé‡è¯•
- `secondDelay`ï¼šé‡è¯•æ—¶é—´é—´éš”

> **æ³¨æ„**ï¼šä¸è¦é‡å¤æ³¨å†ŒåŒä¸€ä¸ªäººè„¸

### è¿œç¨‹æ³¨å†Œ

**æ–¹æ³•åç§°ï¼š** `remoteRegister`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().remoteRegister(reqId, name, path, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        try {
            JSONObject jsonObject = new JSONObject(message);
            int code = jsonObject.optInt("code", -1);
            switch (code) {
                case 0://æˆåŠŸ
                    break;
                case Definition.REMOTE_CODE_FACE_INVALID://å›¾ç‰‡æ— æ•ˆ
                    break;
                default://å…¶ä»–
                    break;
            }
        } catch (JSONException e) {
            e.printStackTrace();
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `name`ï¼šæ³¨å†Œåç§°
- `path`ï¼šå›¾ç‰‡è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡getPictureByIdè·å–

> **æ³¨æ„**ï¼šä¸è¦é‡å¤æ³¨å†ŒåŒä¸€ä¸ªäººè„¸

### è¿œç¨‹è¯†åˆ«

**æ–¹æ³•åç§°ï¼š** `getPersonInfoFromNet`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().getPersonInfoFromNet(reqId, faceId, pictures, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        try {
            JSONObject json = new JSONObject(message);
            JSONObject info = json.getJSONObject("people");
            info.getString("name"); //åç§°
            info.getString("gender"); //æ€§åˆ«
            info.getString("age"); //å¹´é¾„
        } catch (JSONException | NullPointerException e) {
            e.printStackTrace();
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `faceID`ï¼šäººè„¸idï¼Œå¯é€šè¿‡æœ¬åœ°äººè„¸è¯†åˆ«è·å¾—ï¼ˆPersonçš„idï¼‰
- `pictures`ï¼šäººè„¸ç…§ç‰‡ï¼Œå¯é€šè¿‡getPictureByIdæ¥å£è·å¾—

### åˆ‡æ¢æ‘„åƒå¤´

**æ–¹æ³•åç§°ï¼š** `switchCamera`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().switchCamera(reqId, camera, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        try {
            JSONObject json = new JSONObject(message);
            if (Definition.RESPONSE_OK.equals(json.getString("status"))) {
                //åˆ‡æ¢æˆåŠŸ
            }
        } catch (JSONException | NullPointerException e) {
            e.printStackTrace();
        }
    }
});
```


**å‚æ•°è¯´æ˜ï¼š**

- `camera`ï¼šæ‘„åƒå¤´ï¼ŒString ç±»å‹
  - `Definition.JSON_HEAD_FORWARD` å‰ç½®æ‘„åƒå¤´
  - `Definition.JSON_HEAD_BACKWARD` åç½®æ‘„åƒå¤´

## æ‘„åƒå¤´

æœºå™¨äººçš„æ‘„åƒå¤´æœ‰çš„æ˜¯å•æ‘„ï¼Œæœ‰çš„æ˜¯åŒæ‘„ï¼›ä¸åŒäº§å“çº¿æ‘„åƒå¤´ä½¿ç”¨ä¸åŒï¼Œè¯¦è§ä¸‹é¢æ–‡æ¡£ã€‚


#### è±¹å°ç§˜2å’Œè±¹å°ç§˜mini

åŒæ‘„ï¼Œå‰ç½®æ‘„åƒå¤´å¯ä»¥ä½¿ç”¨ Android æ ‡å‡† API æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…±äº«æµè·å–ç›¸æœºé¢„è§ˆæ•°æ®ï¼ˆé€šè¿‡ Android æ ‡å‡† API æ‰“å¼€å‰ç½®æ‘„åƒå¤´ï¼Œä¼šé€ æˆæœºå™¨äººè§†è§‰ç®—æ³•æš‚æ—¶æ— æ³•ä½¿ç”¨ï¼Œé‡Šæ”¾åï¼Œä¸€å®šæ—¶é—´åä¼šæ¢å¤è§†è§‰ç®—æ³•èƒ½åŠ›ï¼‰ã€‚åç½®æ‘„åƒå¤´åªèƒ½ä½¿ç”¨Android æ ‡å‡† API æ‰“å¼€ã€‚


#### æ³¨æ„

ä½¿ç”¨Androidçš„APIæ‰“å¼€ç›¸æœºï¼Œç¬¬ä¸€æ¬¡æˆæƒAPPä½¿ç”¨æ‘„åƒå¤´æ—¶ï¼ŒAPPå¯èƒ½ä¼šå´©æºƒï¼Œä½†ä¹‹åä½¿ç”¨å°±æ²¡æœ‰é™åˆ¶äº†ã€‚å¦‚æœé‡åˆ°æˆæƒæ‘„åƒå¤´å´©æºƒï¼Œé‡æ–°å¼€å¯å³å¯ï¼Œä¹‹åå¯æ­£å¸¸ä½¿ç”¨æ‘„åƒå¤´ã€‚

æ¨ªå±æœºå™¨äººæ³¨æ„ï¼šé€šè¿‡Androidæ ‡å‡†æ–¹å¼å¯åŠ¨ä¹‹åæ–¹å‘æ˜¯é€‰æ‹©90Â°çš„ï¼Œè¿™æ˜¯å› ä¸ºæœºå™¨äººæ²¡æœ‰é™€èºä»ªï¼Œç¨‹åºä¸­é»˜è®¤æ˜¯ç«–å±æ‘„åƒå¤´ï¼Œä½†æœºå™¨äººå®é™…æ˜¯æ¨ªå±è®¾å¤‡ã€‚è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼Œé€šè¿‡Android APIï¼ˆæˆ–å…¶å®ƒå„å®¶è§†é¢‘sdkçš„APIï¼‰è®¾ç½®æ‘„åƒå¤´æ—‹è½¬-90Â°æˆ–æ‘„åƒå¤´æ—‹è½¬270Â°å³å¯çº æ­£ã€‚

ä»¥ä¸‹Demoä¸ºAndroidç›¸æœºAPIä½¿ç”¨ï¼Œä»…ä¾›å‚è€ƒï¼Œå¦‚ä¸æ»¡è¶³ï¼Œè¯·è‡ªè¡Œæ ¹æ®éœ€æ±‚ä¸Šç½‘æŸ¥è¯¢

Camera1çš„Demo

Camera2çš„Demo

### æ‘„åƒå¤´æ•°æ®æµå…±äº«
å› ä¸ºæœºå™¨äººè§†è§‰èƒ½åŠ›VisionSDKéœ€è¦ä½¿ç”¨æ‘„åƒå¤´ï¼Œå¦‚æœæ‘„åƒå¤´è¢«äºŒæ¬¡å¼€å‘çš„ç¨‹åºå ç”¨ï¼Œä¼šå¯¼è‡´æœºå™¨äººäººè„¸æ£€æµ‹ã€äººè„¸è¯†åˆ«ä¸å¯ç”¨ã€‚å¦‚æœæƒ³æ—¢ä½¿ç”¨æ‘„åƒå¤´ï¼Œåˆä¸å½±å“æœºå™¨äººè§†è§‰åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨å…±äº«æ•°æ®æµçš„æ–¹å¼è·å–VisionSDKä¸­çš„æ‘„åƒå¤´æ•°æ®ã€‚æ‘„åƒå¤´æ•°æ®é€šè¿‡SurfaceShareApiè·å–ã€‚å®ƒä¸»è¦æœ‰ä¸‰ä¸ªå…³é”®æ–¹æ³•ï¼š

startRequest() : å¼€å¯å…±äº«æ•°æ®æµ
onImageAvailable(ImageReader reader) ï¼šè¿™æ˜¯ä¸€ä¸ªå›è°ƒï¼Œæ‰€æœ‰å…±äº«æµé‡Œçš„å›¾åƒæ•°æ®ä»è¿™é‡Œå‡ºæ¥
stopPushStream() ï¼šå…³é—­å…±äº«æ•°æ®æµ
å…±äº«æµæ–¹å¼è·å–å›¾åƒæ•°æ®å†…å­˜å’ŒCPUå¼€é”€éƒ½æ¯”è¾ƒå¤§ï¼Œåœ¨ä¸ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè®°å¾—å…³é—­ï¼Œé¿å…å¼•èµ·OOMã€‚å…±äº«æ•°æ®æµå–åˆ°çš„å›¾ç‰‡æ˜¯YUVæ ¼å¼çš„ï¼Œè¦æ¸²æŸ“åˆ°surfaceviewéœ€è¦è½¬æ¢ä¸ºbitmapã€‚

å…·ä½“å‚åŠ ä¸‹é¢ä»£ç ï¼š

```java
package com.ainirobot.videocall.control.sufaceshareengine;
import android.graphics.Bitmap;
import android.graphics.Color;
import android.graphics.ImageFormat;
import android.media.Image;
import android.media.ImageReader;
import android.os.Handler;
import android.os.HandlerThread;
import android.os.Looper;
import android.os.Message;
import android.support.annotation.NonNull;
import android.util.Log;
import android.view.Surface;
import com.ainirobot.coreservice.client.surfaceshare.SurfaceShareApi;
import com.ainirobot.coreservice.client.surfaceshare.SurfaceShareBean;
import com.ainirobot.coreservice.client.surfaceshare.SurfaceShareError;
import com.ainirobot.coreservice.client.surfaceshare.SurfaceShareListener;
import com.ainirobot.videocall.tools.ImageUtils;
import java.nio.ByteBuffer;
import java.util.HashMap;
import java.util.Map;
/**
 * é€šè¿‡Vision SDKè·å–è§†é¢‘æ•°æ®
 */
public class SurfaceShareDataEngine {
    private static final String TAG = "SurfaceShareDataEngine";
    public static final int IMAGE_DATA_FOR_LIVEME = 0;
    public static final int IMAGE_DATA_FOR_LOCAL_PREVIEW = 1;
    public static final int VISION_IMAGE_WIDTH = 640;
    public static final int VISION_IMAGE_HEIGHT = 480;
    private static final int MAX_CACHE_IMAGES = 4; //maxImages ä¿æŒå’ŒVisionSdkä¸€è‡´
    private MessageCallBack mCallBack;
    private ImageReader mImageReader;
    private Handler mHandler;
    private HandlerThread mBackgroundThread;
    private SurfaceShareBean mSurfaceShareBean;
    private int mCurrentError = 0;
    private long log_interval = 0;
    private MyHandler mImageHandler;
    private HandlerThread mImageHandleThread;
    private Surface mRemoteSurface;
    private static class InstanceHolder {
        public static final SurfaceShareDataEngine instance = new SurfaceShareDataEngine();
    }
    public static SurfaceShareDataEngine getInstance() {
        return InstanceHolder.instance;
    }
    private SurfaceShareDataEngine() {}
    public void setMessageCallBack(MessageCallBack callBack){
        Log.i(TAG, "set message callBack: " + callBack);
        this.mCallBack = callBack;
    }
    private boolean initSurfaceResource() {
        Log.d(TAG, "initSurfaceResource ..");
        startBackgroundThread();
        boolean init = initImageSurface();
        if (!init) {
            Log.e(TAG, "Remote Surface instance has been used");
            return false;
        }
        startHandleImageThread();
        return true;
    }
    private void startHandleImageThread() {
        mImageHandleThread = new HandlerThread("ImageHandleThread");
        mImageHandleThread.start();
        mImageHandler = new MyHandler(mImageHandleThread.getLooper());
    }
    public void startRequest() {
        initSurfaceResource();
        if (mSurfaceShareBean == null) {
            mSurfaceShareBean = new SurfaceShareBean();
            mSurfaceShareBean.setName("VideoCall");
        }
        mRemoteSurface = mImageReader.getSurface();
        Log.d(TAG, "startRequest getSurface:" + mRemoteSurface);
        SurfaceShareApi.getInstance().requestImageFrame(mRemoteSurface, mSurfaceShareBean, new SurfaceShareListener() {
            @Override
            public void onError(int error, String message) {
                super.onError(error, message);
                Log.d(TAG, "requestImageFrame onError error :" + error);
                mCurrentError = error;
                if (mCallBack != null) {
                    mCallBack.onError(error);
                }
            }
            @Override
            public void onStatusUpdate(int status, String message) {
                super.onStatusUpdate(status, message);
                Log.d(TAG, "requestImageFrame onStatusUpdate status:" + status);
            }
        });
    }
    private boolean initImageSurface() {
        if (mImageReader != null) {
            Log.d(TAG, "initImageSurface has an ImageReader instance already!");
            return false;
        }
        mImageReader = ImageReader.newInstance(VISION_IMAGE_WIDTH , VISION_IMAGE_HEIGHT, ImageFormat.YUV_420_888, MAX_CACHE_IMAGES);
        mImageReader.setOnImageAvailableListener(new MyOnImageAvailableListener(), mHandler);
        return true;
    }
    private void startBackgroundThread() {
        if (mBackgroundThread != null && mHandler != null) {
            Log.d(TAG, "startBackgroundThread has already start a mBackgroundThread");
            return;
        }
        mBackgroundThread = new HandlerThread("ExternalBackground");
        mBackgroundThread.start();
        mHandler = new Handler(mBackgroundThread.getLooper());
    }
    private class MyOnImageAvailableListener implements ImageReader.OnImageAvailableListener {
        @Override
        public void onImageAvailable(ImageReader reader) {
            long startTime = System.currentTimeMillis();
            Image image = null;
            try {
                image = reader.acquireLatestImage();
                if (image == null){
                    Log.d(TAG, "onImageAvailable image is null");
                    return;
                }
                if (mBackgroundThread == null){
                    Log.d(TAG, "onImageAvailable mBackgroundThread is null");
                    return;
                }
 //ä»¥ä¸‹æ˜¯çŒè±¹çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ­¤å¤„å¯ä»¥æ”¹ä¸ºå…¶å®ƒä¸šåŠ¡é€»è¾‘ã€‚æ³¨æ„å¤„ç†å®Œæˆåä¸€å®šè¦é‡Šæ”¾å›¾ç‰‡ï¼Œå¦åˆ™æå®¹æ˜“å¼•èµ·OOMå´©æºƒ
                //pushYuv(image);
            } catch (Exception e) {
                e.printStackTrace();
            } finally {
                if (log_interval % 60 == 0){
                    Log.d(TAG, "onImageAvailable push image time:"+(System.currentTimeMillis() - startTime)+"ms");
                }
                log_interval++;
                if (image != null) {
                    image.close();
                }
            }
        }
    }
    private class MyHandler extends Handler{
        MyHandler(Looper looper){
            super(looper);
        }
        @Override
        public void handleMessage(Message msg) {
            super.handleMessage(msg);
            if (msg != null){
                Map<Integer, byte[]> data = (Map<Integer, byte[]>) msg.obj;
                if (mCallBack != null) {
                    mCallBack.onData(data);
                }
            }
        }
    }
    private void stopBackgroundThread() {
        if (mBackgroundThread == null) {
            Log.i(TAG, "the background thread is null");
            return;
        }
        Log.i(TAG, "stopBackgroundThread thread id:" + mBackgroundThread.getName() + "," + mBackgroundThread.getThreadId());
        mBackgroundThread.quitSafely();
        try {
            mBackgroundThread.join(50);
            mBackgroundThread = null;
            mHandler = null;
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
    private void stopHandleThread() {
        if (mImageHandleThread == null) {
            Log.i(TAG, "the mImageHandleThread is null");
            return;
        }
        mImageHandleThread.quitSafely();
        try {
            mImageHandleThread.join(50);
            mImageHandleThread = null;
            mImageHandler = null;
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
    private void closeImageReader() {
        Log.d(TAG, "closeImageReader == ");
        if (mImageReader != null) {
            mImageReader.close();
            mImageReader = null;
        }
        Log.d(TAG, "closeImageReader mRemoteSurface release");
        if (mRemoteSurface != null){
            mRemoteSurface.release();
            mRemoteSurface = null;
        }
    }
    public void stopPushStream() {
        if (mCurrentError == SurfaceShareError.ERROR_SURFACE_SHARE_USED){
            Log.d(TAG, "stopPushStream ERROR_SURFACE_SHARE_USED .");
            return;
        }
        SurfaceShareApi.getInstance().abandonImageFrame(mSurfaceShareBean);
        stopBackgroundThread();
        stopHandleThread();
        closeImageReader();
        mSurfaceShareBean = null;
        mCurrentError = 0;
        log_interval = 0;
    }
    public interface MessageCallBack{
        void onData(Map<Integer, byte[]> bytes);
        void onError(int error);
    }
}
```

åœ¨çŒæˆ·çš„æœºå™¨äººä»£ç ä¸­çš„é€»è¾‘ä»£ç æ˜¯è¿™æ ·å¤„ç†YUVå›¾åƒçš„ï¼š

```java
    pushYuv(image);
    private void pushYuv(@NonNull Image image) {
        byte[] yuv = new byte[image.getHeight() * image.getWidth() * ImageFormat.getBitsPerPixel(ImageFormat.YUV_420_888) / 8];
        if (log_interval % 60 == 0){
            Log.d(TAG, "pushYuv w:" + image.getWidth() + ",h:" + image.getHeight() + ",planes.len:" + image.getPlanes().length+", log_interval:"+log_interval);
        }
        readImageIntoBuffer(image, yuv);
//        frameMirror(yuv, image.getWidth(), image.getHeight());
        if (mImageHandler == null){
            Log.d(TAG, "pushYuv mImageHandler is null");
            return;
        }
        byte[] localPreviewData = ImageUtils.generateNV21Data(image);
        Map<Integer, byte[]> dataMap = new HashMap<>();
        dataMap.put(IMAGE_DATA_FOR_LIVEME, yuv);
        dataMap.put(IMAGE_DATA_FOR_LOCAL_PREVIEW, localPreviewData);
        Message.obtain(mImageHandler,0, dataMap).sendToTarget();
    }
    public static void conver_argb_to_i420(byte[] i420, byte[] argb, int width, int height) {
        final int frameSize = width * height;
        int yIndex = 0;                   // Y start index
        int uIndex = frameSize;           // U statt index
        int vIndex = frameSize * 5 / 4; // V start index: w*h*5/4
        int a, R, G, B, Y, U, V;
        int index = 0;
        for (int j = 0; j < height; j++) {
            for (int i = 0; i < width; i++) {
                a = (argb[index] & 0xff000000) >> 24; //  is not used obviously
                R = (argb[index] & 0xff0000) >> 16;
                G = (argb[index] & 0xff00) >> 8;
                B = (argb[index] & 0xff) >> 0;
                // well known RGB to YUV algorithm
                Y = ((66 * R + 129 * G + 25 * B + 128) >> 8) + 16;
                U = ((-38 * R - 74 * G + 112 * B + 128) >> 8) + 128;
                V = ((112 * R - 94 * G - 18 * B + 128) >> 8) + 128;
                // I420(YUV420p) -> YYYYYYYY UU VV
                i420[yIndex++] = (byte) ((Y < 0) ? 0 : ((Y > 255) ? 255 : Y));
                if (j % 2 == 0 && i % 2 == 0) {
                    i420[uIndex++] = (byte) ((U < 0) ? 0 : ((U > 255) ? 255 : U));
                    i420[vIndex++] = (byte) ((V < 0) ? 0 : ((V > 255) ? 255 : V));
                }
                index++;
            }
        }
    }
    private static void readImageIntoBuffer(Image image, byte[] data) {
        int width = image.getWidth();
        int height = image.getHeight();
        Image.Plane[] planes = image.getPlanes();
        if (planes == null) {
            Log.i(TAG, "get image planes is null");
            return;
        }
        int offset = 0;
        int planeLen = planes.length;
        for (int plane = 0; plane < planeLen; plane++) {
            ByteBuffer buffer = planes[plane].getBuffer();
            int rowStride = planes[plane].getRowStride();
            int pixelStride = planes[plane].getPixelStride();
            int planeWidth = plane == 0 ? width : width / 2;
            int planeHeight = plane == 0 ? height : height / 2;
            if ((pixelStride == 1) && (rowStride == planeWidth)) {
                buffer.get(data, offset, planeWidth * planeHeight);
                offset += planeWidth * planeHeight;
            } else {
                byte[] rowData = new byte[rowStride];
                for (int row = 0; row < planeHeight - 1; row++) {
                    buffer.get(rowData, 0, rowStride);
                    for (int col = 0; col < planeWidth; col++) {
                        data[(offset++)] = rowData[(col * pixelStride)];
                    }
                }
                buffer.get(rowData, 0, Math.min(rowStride, buffer.remaining()));
                for (int col = 0; col < planeWidth; col++) {
                    data[(offset++)] = rowData[(col * pixelStride)];
                }
            }
        }
    }
    public static byte[] frameMirror(byte[] data, int width, int height) {
        byte tempData;
        for (int i = 0; i < height * 3 / 2; i++) {
            for (int j = 0; j < width / 2; j++) {
                tempData = data[i * width + j];
                data[i * width + j] = data[(i + 1) * width - 1 - j];
                data[(i + 1) * width - 1 - j] = tempData;
            }
        }
        return data;
    }
    public static byte[] readRgbaImageToBuffer(Image imageFrame) {
        int w = imageFrame.getWidth();
        int h = imageFrame.getHeight();
        Image.Plane[] planes = imageFrame.getPlanes();
        if (planes == null) {
            Log.i(TAG, "get image planes is null");
            return null;
        }
        ByteBuffer buffer = planes[0].getBuffer();
        int pixelStride = planes[0].getPixelStride();
        int rowStride = planes[0].getRowStride();
        int rowPadding = rowStride - pixelStride * w;
        Log.d(TAG, "readImageIntoBuffer: rowStride:" + rowStride + ",pixelStride:" + pixelStride + ",rowPadding:" + rowPadding);
        Bitmap bitmap = Bitmap.createBitmap(w + rowPadding / pixelStride, h, Bitmap.Config.ARGB_8888);
        bitmap.copyPixelsFromBuffer(buffer);
        byte[] pixels = new byte[w * h * 4]; // Allocate for RGB
        int k = 0;
        for (int x = 0; x < h; x++) {
            for (int y = 0; y < w; y++) {
                int color = bitmap.getPixel(y, x);
                // rgba
                pixels[k * 4 + 0] = (byte) Color.red(color);
                pixels[k * 4 + 1] = (byte) Color.green(color);
                pixels[k * 4 + 2] = (byte) Color.blue(color);
                pixels[k * 4 + 3] = (byte) Color.alpha(color);
                k++;
            }
        }
        return pixels;
    }
```

SurfaceShareDataEngine.java

## åŸºç¡€è¿åŠ¨

### ç›´çº¿è¿åŠ¨

**æ–¹æ³•åç§°ï¼š** `goForward` / `goBackward`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
CommandListener motionListener = new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        if ("succeed".equals(message)) {
            //è°ƒç”¨æˆåŠŸ
        } else {
            //è°ƒç”¨å¤±è´¥
        }
    }
};
RobotApi.getInstance().goForward(reqId, speed, motionListener);
RobotApi.getInstance().goForward(reqId, speed, distance, motionListener);
RobotApi.getInstance().goForward(reqId, speed, distance, avoid, motionListener);
RobotApi.getInstance().goBackward(reqId, speed, motionListener);
RobotApi.getInstance().goBackward(reqId, speed, distance, motionListener);
```

**å‚æ•°è¯´æ˜ï¼š**

- `speed`ï¼šè¿åŠ¨é€Ÿåº¦ï¼Œå•ä½m/sï¼ŒèŒƒå›´ä¸º 0 ~ 1.0, å¤§äº1.0çš„é€Ÿåº¦æŒ‰1.0è¿åŠ¨
- `distance`ï¼šè¿åŠ¨è·ç¦»ï¼Œå•ä½mï¼Œå€¼éœ€å¤§äº0ã€‚
- `avoid`ï¼šæ˜¯å¦è¡Œèµ°çš„æ—¶å€™è¿›è¡Œé¿åœï¼Œåªæœ‰å‰è¿›å¯ä»¥é¿åœã€‚
### æ—‹è½¬è¿åŠ¨

**æ–¹æ³•åç§°ï¼š** `turnLeft` / `turnRight`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
CommandListener rotateListener = new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        if ("succeed".equals(message)) {
            //è°ƒç”¨æˆåŠŸ
        } else {
            //è°ƒç”¨å¤±è´¥
        }
    }
};
RobotApi.getInstance().turnLeft(reqId, speed, rotateListener);
RobotApi.getInstance().turnLeft(reqId, speed, angle, rotateListener);
RobotApi.getInstance().turnRight(reqId, speed, rotateListener);
RobotApi.getInstance().turnRight(reqId, speed, angle, rotateListener);
```

**å‚æ•°è¯´æ˜ï¼š**

- `speed`ï¼šæ—‹è½¬é€Ÿåº¦ï¼Œå•ä½ï¼šåº¦/sï¼ŒèŒƒå›´ä¸º 0 ~ 50 åº¦/s
- `angle`ï¼šæ—‹è½¬è§’åº¦ï¼Œå•ä½ï¼šåº¦ï¼Œå€¼éœ€å¤§äº0
### é€šè¿‡è®¾å®šè§’é€Ÿåº¦ã€çº¿é€Ÿåº¦çš„æ–¹å¼æ§åˆ¶æœºå™¨äºº

**æ–¹æ³•åç§°ï¼š** `motionArcWithObstacles`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().motionArcWithObstacles(reqID,0.5,0.5,new CommandListener(){
    @Override
    public void onResult(int result, String message, String extraData) {
    }
    @Override
    public void onStatusUpdate(int status, String data, String extraData) {
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `lineSpeed`ï¼šçº¿é€Ÿåº¦ï¼ŒèŒƒå›´ -1.2 ~ 1.2
- `angularSpeed`ï¼šè§’é€Ÿåº¦ï¼ŒèŒƒå›´ -2 ~ 2
### åœæ­¢

**æ–¹æ³•åç§°ï¼š** `stopMove`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().stopMove(reqId, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        if ("succeed".equals(message)) {
            //è°ƒç”¨æˆåŠŸ
        } else {
            //è°ƒç”¨å¤±è´¥
        }
    }
});
```

> **æ³¨æ„ï¼š** è¯¥æ¥å£åªå¯ç”¨äºåœæ­¢å‰è¿›ã€åé€€åŠæ—‹è½¬ï¼Œä¸å¯ç”¨äºåœæ­¢å¯¼èˆªåŠå¤´éƒ¨è¿åŠ¨

### å¤´éƒ¨äº‘å°è¿åŠ¨

**æ–¹æ³•åç§°ï¼š** `moveHead`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().moveHead(reqId, hMode, vMode, hAngle, vAngle, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        try {
            JSONObject json = new JSONObject(message);
            String status = json.getString("status");
            if (Definition.CMD_STATUS_OK.equals(status)) {
                //æ“ä½œæˆåŠŸ
            }
        } catch (JSONException | NullPointerException e) {
            e.printStackTrace();
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `hMode`ï¼šå·¦å³è½¬åŠ¨çš„æ¨¡å¼ï¼Œç»å¯¹è¿åŠ¨ï¼šabsoluteï¼Œç›¸å¯¹è¿åŠ¨ï¼šrelative
- `vMode`ï¼šä¸Šä¸‹è¿åŠ¨çš„æ¨¡å¼ï¼Œç»å¯¹è¿åŠ¨ï¼šabsoluteï¼Œç›¸å¯¹è¿åŠ¨ï¼šrelative
- `hAngle`ï¼šå·¦å³è½¬åŠ¨è§’åº¦ï¼ŒèŒƒå›´ï¼š-120 ~ 120
- `vAngle`ï¼šä¸Šä¸‹è¿åŠ¨çš„è§’åº¦ï¼ŒèŒƒå›´ï¼š0 ~ 90

> **æ³¨æ„ï¼š** è¯·æ³¨æ„æœºå™¨ç±»å‹çš„ç‰©ç†å‹é™åˆ¶ï¼Œminiã€è±¹å°ç§˜2æœºå‹å·¦å³è½¬åŠ¨æ¨¡å¼æ— æ•ˆ

### æ¢å¤äº‘å°åˆå§‹è§’åº¦

**æ–¹æ³•åç§°ï¼š** `resetHead`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().resetHead(reqId, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        try {
            JSONObject json = new JSONObject(message);
            String status = json.getString("status");
            if (Definition.CMD_STATUS_OK.equals(status)) {
                //æ“ä½œæˆåŠŸ
            }
        } catch (JSONException | NullPointerException e) {
            e.printStackTrace();
        }
    }
});
```

## åœ°å›¾åŠä½ç½®

### ç®€ä»‹

åœ°å›¾å’Œå®šä½æ˜¯æœºå™¨äººå¯¼èˆªçš„å…ˆå†³æ¡ä»¶ï¼Œæ–°å»ºåœ°å›¾ç›¸å½“äºå‘ŠçŸ¥æœºå™¨äººå¯è¡Œèµ°çš„èŒƒå›´ï¼Œå®šä½ç›¸å½“äºå‘ŠçŸ¥æœºå™¨äººç›®å‰æ‰€å¤„çš„ä½ç½®ã€‚æœºå™¨äººè‡ªå¸¦"åœ°å›¾å·¥å…·"å¯ä»¥å®Œæˆæ‰€æœ‰åœ°å›¾å’Œç‚¹ä½çš„æ“ä½œï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±ä½¿ç”¨apiå®ŒæˆåŠŸèƒ½

**è®¾ç‚¹ï¼š** æŒ‡å‘ŠçŸ¥æœºå™¨äººå½“å‰ç‚¹ä½çš„åç§°ï¼Œä¹‹åå¯ä½¿ç”¨æ¥å£å¯¼èˆªåˆ°è¿™ä¸ªç‚¹ä½

### å»ºå›¾åŠå®šä½

å»ºå›¾åŠå®šä½å¯ä½¿ç”¨ç³»ç»Ÿé›†æˆçš„åœ°å›¾å·¥å…·è¿›è¡Œæ“ä½œ.

> åœ°å›¾åæ ‡ä¸­ï¼Œxyæ˜¯æœºå™¨äººåœ¨åœ°å›¾ä¸­çš„ä½ç½®ï¼Œthetaæ˜¯æœºå™¨äººçš„é¢æœæ–¹å‘ï¼ˆå•ä½ä¸ºå¼§åº¦ï¼‰

### å®šä½ï¼ˆè®¾ç½®æœºå™¨äººåˆå§‹åæ ‡ç‚¹ï¼‰

**æ–¹æ³•åç§°ï¼š** `setPoseEstimate`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
try {
    JSONObject params = new JSONObject();
    //xåæ ‡
    params.put(Definition.JSON_NAVI_POSITION_X, x);
    //yåæ ‡
    params.put(Definition.JSON_NAVI_POSITION_Y, y);
    //zåæ ‡
    params.put(Definition.JSON_NAVI_POSITION_THETA, theta);
    RobotApi.getInstance().setPoseEstimate(reqId, params.toString(), new CommandListener() {
        @Override
        public void onResult(int result, String message) {
            if ("succeed".equals(message)) {
                //å®šä½æˆåŠŸ
            }
        }
    });
} catch (JSONException e) {
    e.printStackTrace();
}
```
### åˆ¤æ–­å½“å‰æ˜¯å¦å·²å®šä½

**æ–¹æ³•åç§°ï¼š** `isRobotEstimate`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().isRobotEstimate(reqId, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        if (!"true".equals(message)) {
            //å½“å‰æœªå®šä½
        } else {
            //å½“å‰å·²å®šä½
        }
    }
});
```
### è®¾ç½®å½“å‰ä½ç½®åç§°

**æ–¹æ³•åç§°ï¼š** `setLocation`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().setLocation(reqId, placeName, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        if ("succeed".equals(message)) {
            //ä¿å­˜ä½ç½®ç‚¹æˆåŠŸ
        } else {
            //ä¿å­˜ä½ç½®ç‚¹å¤±è´¥
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `placeName`ï¼šä½ç½®åç§°

> **æ³¨æ„ï¼š** è°ƒç”¨è¯¥æ¥å£å‰éœ€è¦ç¡®ä¿å·²å®šä½

### æ ¹æ®ä½ç½®åç§°è·å–åæ ‡ç‚¹

**æ–¹æ³•åç§°ï¼š** `getLocation`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().getLocation(reqId, placeName, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        try {
            JSONObject json = new JSONObject(message);
            //å½“å‰ä½ç½®æ˜¯å¦å­˜åœ¨
            boolean isExist = json.getBoolean(Definition.JSON_NAVI_SITE_EXIST);
            if (isExist) {
                //xåæ ‡
                double x = json.getDouble(Definition.JSON_NAVI_POSITION_X);
                //yåæ ‡
                double y = json.getDouble(Definition.JSON_NAVI_POSITION_Y);
                //é¢æœæ–¹å‘
                double z = json.getDouble(Definition.JSON_NAVI_POSITION_THETA);
            }
        } catch (JSONException | NullPointerException e) {
            e.printStackTrace();
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `placeName`ï¼šä½ç½®åç§°

> **æ³¨æ„ï¼š** setLocationä¿å­˜çš„ä½ç½®ä¼šä¸åœ°å›¾å…³è”ï¼Œé€šè¿‡getLocationè·å–çš„æ—¶å€™ä¹Ÿåº”è¯¥ä¿æŒç›¸åŒçš„åœ°å›¾ï¼Œå¦åˆ™getLocationè·å–å¤±è´¥

### è·å–å½“å‰åœ°å›¾æ‰€æœ‰ä½ç½®ç‚¹

**æ–¹æ³•åç§°ï¼š** `getPlaceList`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().getPlaceList(reqId, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        try {
            JSONArray jsonArray = new JSONArray(message);
            int length = jsonArray.length();
            for (int i = 0; i < length; i++) {
                JSONObject json = jsonArray.getJSONObject(i);
                //å¸¸ç”¨
                json.getString("name"); //ä½ç½®åç§°
                json.getDouble("x"); //xåæ ‡
                json.getDouble("y"); //yåæ ‡
                //ä¸å¸¸ç”¨
                json.getDouble("theta"); //é¢æœæ–¹å‘
                json.getString("id"); //ä½ç½®id
                json.getLong("time");//æ›´æ–°æ—¶é—´
                json.getInt("status"); //0:æ­£å¸¸åŒºåŸŸï¼Œå¯ä»¥åˆ° 1:ç¦è¡ŒåŒºï¼Œä¸å¯ä»¥åˆ° 2:åœ°å›¾å¤–ï¼Œä¸å¯ä»¥åˆ°
            }
        } catch (JSONException | NullPointerException e) {
            e.printStackTrace();
        }
    }
});
```
### è·å–æœºå™¨äººå½“å‰åæ ‡ç‚¹

**æ–¹æ³•åç§°ï¼š** `getPosition`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().getPosition(reqId, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        try {
            JSONObject json = new JSONObject(message);
            //xåæ ‡
            double x = json.getDouble(Definition.JSON_NAVI_POSITION_X);
            //yåæ ‡
            double y = json.getDouble(Definition.JSON_NAVI_POSITION_Y);
            //é¢æœæ–¹å‘
            double z = json.getDouble(Definition.JSON_NAVI_POSITION_THETA);
        } catch (JSONException | NullPointerException e) {
            e.printStackTrace();
        }
    }
});
```

> **æ³¨æ„ï¼š** è°ƒç”¨è¯¥æ¥å£å‰éœ€è¦ç¡®ä¿å·²å®šä½

### åˆ¤æ–­æœºå™¨äººæ˜¯å¦åœ¨ä½ç½®ç‚¹

**æ–¹æ³•åç§°ï¼š** `isRobotInLocations`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
try {
    JSONObject params = new JSONObject();
    params.put(Definition.JSON_NAVI_TARGET_PLACE_NAME, placeName); //ä½ç½®åç§°
    params.put(Definition.JSON_NAVI_COORDINATE_DEVIATION, range); //ä½ç½®èŒƒå›´
    RobotApi.getInstance().isRobotInlocations(reqId,
            params.toString(), new CommandListener() {
                @Override
                public void onResult(int result, String message) {
                    try {
                        JSONObject json = new JSONObject(message);
                        //æ˜¯å¦åœ¨ç›®æ ‡ç‚¹
                        json.getBoolean(Definition.JSON_NAVI_IS_IN_LOCATION);
                    } catch (JSONException e) {
                        e.printStackTrace();
                    }
                }
            });
} catch (JSONException e) {
    e.printStackTrace();
}
```

**å‚æ•°è¯´æ˜ï¼š**

- `placeName`ï¼šä½ç½®åç§°
- `range`ï¼šä½ç½®èŒƒå›´ï¼Œå•ä½m
### è·å–å½“å‰åœ°å›¾åç§°

**æ–¹æ³•åç§°ï¼š** `getMapName`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().getMapName(reqId, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        if (!TextUtils.isEmpty(message)) {
            //messageä¸ºåœ°å›¾åç§°
            String mapName = message;
        }
    }
});
```
### ä½ç½®çŠ¶æ€æ”¹å˜ç›‘å¬

å¯åŠ¨ä¸€ä¸ªç›‘å¬å›è°ƒï¼Œåœ¨ä½ç½®å’Œä½ç½®çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘å›è°ƒã€‚

```java
public class Pose {
    public float px, py, theta;
    public final long time;
    public String name;
    /**
     * FREE = 0;      // æ­£å¸¸åŒºåŸŸï¼Œå¯ä»¥åˆ°
     * OBSTACLE = 1;  // ç¦è¡ŒåŒºï¼Œä¸å¯ä»¥åˆ°
     * OUTSIDE = 2;   // åœ°å›¾å¤–ï¼Œä¸å¯ä»¥åˆ°
     */
    public int status;
    public float distance;
}
RobotApi.getInstance().registerStatusListener(Definition.STATUS_POSE,
    new StatusListener(){
        @Override
        public void onStatusUpdate(String type, String value) {
            Pose pose = GsonUtil.fromJson(value, Pose.class);
        }
    });
```
### åˆ‡æ¢åœ°å›¾

**æ–¹æ³•åç§°ï¼š** `switchMap`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().switchMap(reqId, mapName, new CommandListener(){
    @Override
    public void onResult(int result, String message) {
        if ("succeed".equals(message)) {
            //åˆ‡æ¢åœ°å›¾æˆåŠŸ
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `mapName`ï¼šåœ°å›¾åç§°

> **æ³¨æ„ï¼š** åˆ‡æ¢åœ°å›¾åéœ€è¦é‡æ–°å®šä½

### è¯»å–åœ°å›¾PGMæ–‡ä»¶å¹¶è¿›å±•ç¤ºï¼ˆåŒ…å«ç‚¹ä½åæ ‡è½¬æ¢ï¼‰

è¯»å–åœ°å›¾å’Œåæ ‡è½¬æ¢æ˜¯ä¸€æ•´å¥—åœ°å›¾å·¥å…·åœ¨æ”¯æ’‘ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
/*
 * getMap
 * è·å¾—å½“å‰åœ°å›¾
 * åœ°å›¾å…·æœ‰å½“å‰æœºå™¨äººä½ç½®ä¿¡æ¯ï¼Œæ–¹å‘åæ ‡ä¸å¯ç‚¹å‡»å¯¼èˆªçš„ä½ç½®ç‚¹ä½
 * Get the current map
 * The map has current robot position information, direction coordinates and clickable navigation positions
 * å…±äº«å†…å­˜è·å– map.pgm æ–‡ä»¶
 * */
private void getMap(final String name) {
    Log.d(TAG, "getMapPgmPFD: mapName=" + name);
    //è·å– map.pgm æ–‡ä»¶æè¿°ç¬¦
    ParcelFileDescriptor mapPgmPFD = ShareMemoryApi.getInstance().getMapPgmPFD(name);
    FileDescriptor fd = mapPgmPFD.getFileDescriptor();
    FileInputStream fileInputStream = new FileInputStream(fd);
    //ä»æ–‡ä»¶æè¿°ç¬¦è¯»å–æ•°æ®æµï¼Œè§£æä¸º RoverMapï¼ˆæ­¤é€»è¾‘å’Œä¹‹å‰ä¸€è‡´ï¼‰
    mRoverMap = MapppUtils.loadPFD2RoverMap(fileInputStream);
    
    //TODO è‡ªå®šä¹‰æ“ä½œ
    
    //é‡Šæ”¾ service å±‚èµ„æº
    ShareMemoryApi.getInstance().releaseGetMapPgmPFD();
}

/**
 * å…±äº«å†…å­˜ä¿®æ”¹ map.pgm æ–‡ä»¶ï¼Œæµ‹è¯•ä»£ç 
 */
private void setMapPgmPFD(String mapNameï¼ŒRoverMap roverMap) {
    byte[] bytes = MapUtils.saveRoverMapToPFDData(roverMap);
    boolean result = ShareMemoryApi.getInstance().setMapPgmPFD(mapName, bytesT);
    Log.d(TAG, "setMapPgmPFD: result=" + result);
}
```

å¦‚æœæœ‰ç›¸å…³éœ€æ±‚ï¼Œè¯·æ‹·è´æˆ–å‚è€ƒç¤ºä¾‹ä»£ç ä¸­NavFragmentéƒ¨åˆ†ä»£ç ï¼Œæœ€ç»ˆå¯æŠŠæœºå™¨äººä¸­çš„åœ°å›¾ã€ç‚¹ä½ä¿¡æ¯è¯»å‡ºå¹¶å±•ç¤ºæˆå¦‚ä¸‹å½¢å¼ã€‚ä¸‹è½½ä»£ç 

### æ‰“å¼€/å…³é—­ é›·è¾¾æ•°æ®ä¸ŠæŠ¥

**æ–¹æ³•åç§°ï¼š** `setNavigationLineData`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().setNavigationLineData(reqId, enabled);
```

**å‚æ•°è¯´æ˜ï¼š**

- `enabled`ï¼štrueåˆ™å¯ç”¨é›·è¾¾æ•°æ®ä¸ŠæŠ¥ï¼›falseåˆ™å…³é—­é›·è¾¾æ•°æ®ä¸ŠæŠ¥

### é›·è¾¾æ•°æ®ç›‘å¬

```java
RobotApi.getInstance().registerStatusListener(Definition.STATUS_LINE_DATA,
    new StatusListener(){
        @Override
        public void onStatusUpdate(String type, String value) {
            List<Pose> list = GsonUtil.getGson().fromJson(data, new TypeToken<List<Pose>>() {
            }.getType());
        }
    });
```

> **æ³¨æ„ï¼š** éœ€è¦setNavigationLineDataå¼€å¯é›·è¾¾æ•°æ®ä¸ŠæŠ¥ï¼Œæ‰ä¼šæœ‰æ•°æ®ï¼›ä½¿ç”¨å®Œæ¯•åï¼Œå…³é—­é›·è¾¾æ•°æ®ä¸ŠæŠ¥ï¼Œä¸”unregisterStatusListenerï¼Œé‡Šæ”¾èµ„æº

## å¯¼èˆª

### ä»‹ç»

å¯¼èˆªæŒ‡æœºå™¨äººçš„è¡Œèµ°èƒ½åŠ›ï¼Œæœºå™¨äººå¯ä»¥ä»Aç‚¹è¡ŒåŠ¨è‡³Bç‚¹ï¼Œè¡Œèµ°è¿‡ç¨‹ä¸­å¯ä»¥è‡ªåŠ¨è§„åˆ’è·¯çº¿ï¼Œå¯ä»¥æœ‰æ•ˆé¿å¼€éšœç¢ç‰©ã€‚

æœºå™¨äººå¯¼èˆªæ‰€ä½¿ç”¨çš„ä¼ æ„Ÿå™¨æ¯”è¾ƒå¤šï¼ŒåŒ…æ‹¬åº•éƒ¨æ¿€å…‰é›·è¾¾ï¼ŒRGBDï¼Œå¤´éƒ¨IRä¼ æ„Ÿå™¨ï¼ˆéƒ¨åˆ†æœºå‹ï¼‰ç­‰ï¼Œæ‰€ä»¥åœ¨å¯¼èˆªä¸­è¯·ä¸è¦é®æŒ¡è¿™äº›ä¼ æ„Ÿå™¨ï¼Œä»¥å…å‡ºç°æœºå™¨äººä¸èµ°ï¼Œè·¯å¾„è§„åˆ’å¤±è´¥ç­‰é—®é¢˜ã€‚

> **é‡è¦æç¤ºï¼š** æœºå™¨äººèƒ½æ‰§è¡Œå¯¼èˆªåŠ¨ä½œçš„å‰ææ˜¯ï¼šæœºå™¨äººå·²æ–°å»ºåœ°å›¾ï¼Œå¹¶ä¸”åœ¨è¯¥åœ°å›¾ä¸Šå·²ç»å®šä½æˆåŠŸï¼Œé›·è¾¾å¤„äºå¼€å¯çŠ¶æ€ï¼Œè¯·ä¸€å®šè¦æ³¨æ„è¿™ä¸€ç‚¹ï¼

### å¯¼èˆªçŠ¶æ€å’Œé”™è¯¯ç å®šä¹‰

å¯¼èˆªç³»åˆ—APIä¸­å¯èƒ½å‡ºç°çš„çŠ¶æ€å’Œé”™è¯¯ç å¯¹ç…§è¡¨

#### å¯¼èˆªçŠ¶æ€å®šä¹‰ï¼ˆå¯¹åº”å¯¼èˆªnavigationListenerçš„onStatusUpdateï¼‰

```java
STATUS_START_NAVIGATION = 1014; //å¼€å§‹å¯¼èˆª
STATUS_START_CRUISE = 1015; //å¼€å§‹å·¡èˆª
STATUS_NAVI_AVOID = 1018; //å¼€å§‹é¿éšœ
STATUS_NAVI_AVOID_END = 1019; //é¿éšœç»“æŸ
STATUS_NAVI_OUT_MAP = 1020; //èµ°å‡ºåœ°å›¾ï¼Œå»ºè®®è°ƒç”¨stopNavigationåœæ­¢å¯¼èˆª
STATUS_NAVI_MULTI_ROBOT_WAITING = 1034; //å¤šæœºè°ƒåº¦ç­‰å¾…
STATUS_NAVI_MULTI_ROBOT_WAITING_END = 1035; //å¤šæœºè°ƒåº¦ç­‰å¾…ç»“æŸ
STATUS_NAVI_GO_STRAIGHT = 1036; //å¼€å§‹ç›´è¡Œ
STATUS_NAVI_TURN_LEFT = 1037; //å¼€å§‹å·¦è½¬å¼¯
STATUS_NAVI_TURN_RIGHT = 1038; //å¼€å§‹å³è½¬å¼¯
STATUS_NAVI_GLOBAL_PATH_FAILED = 1025; //è·¯å¾„è§„åˆ’å¤±è´¥ï¼Œå¯¼èˆªå¤±è´¥ï¼Œéœ€è¦å¤„ç†æŠ¥é”™ï¼Œå»ºè®®è°ƒç”¨stopNavigationåœæ­¢å¯¼èˆª
```

#### å¯¼èˆªé”™è¯¯ç å®šä¹‰ï¼ˆå¯¹åº”å¯¼èˆªnavigationListenerçš„onErrorï¼‰

```java
ERROR_DESTINATION_NOT_EXIST = -108; //ç›®çš„åœ°ä¸å­˜åœ¨
ERROR_DESTINATION_CAN_NOT_ARRAIVE = -109; //é¿éšœè¶…æ—¶ï¼Œç›®çš„åœ°ä¸å¯è¾¾
ERROR_IN_DESTINATION = -113; //å½“å‰å·²åœ¨ç›®çš„åœ°å‘¨å›´
ERROR_NOT_ESTIMATE = -116; //å½“å‰æœªå®šä½
ERROR_MULTI_ROBOT_WAITING_TIMEOUT = -125; //å¤šæœºè°ƒåº¦ç­‰å¾…è¶…æ—¶
ERROR_NAVIGATION_FAILED = -120; //å¯¼èˆªå› å…¶å®ƒåŸå› å¤±è´¥ï¼Œå…œåº•å¤±è´¥
ACTION_RESPONSE_ALREADY_RUN = -1; //å½“å‰æ¥å£å·²ç»è°ƒç”¨ï¼Œè¯·å…ˆåœæ­¢ï¼Œæ‰èƒ½å†æ¬¡è°ƒç”¨
ACTION_RESPONSE_REQUEST_RES_ERROR = -6; //å·²ç»æœ‰éœ€è¦æ§åˆ¶åº•ç›˜çš„æ¥å£è°ƒç”¨ï¼Œè¯·å…ˆåœæ­¢ï¼Œæ‰èƒ½ç»§ç»­è°ƒç”¨
```

### å¯¼èˆªåˆ°æŒ‡å®šä½ç½®

**æ–¹æ³•åç§°ï¼š** `startNavigation`

**ç»“æœå›è°ƒï¼š**

ActionListener navigationListener = new ActionListener() {    
        @Override
        public void onResult(int status, String response) throws RemoteException {
            switch (status) {
                case Definition.RESULT_OK:
                    if ("true".equals(response)) {
                        //å¯¼èˆªæˆåŠŸ
                    } else {
                        //å¯¼èˆªå¤±è´¥
                    }
                    break;
               case Definition.ACTION_RESPONSE_STOP_SUCCESS://å–æ¶ˆå¯¼èˆªä»»åŠ¡æˆåŠŸ
                    break;
            }
        }    
        @Override public void onError(int errorCode, String errorString) throws RemoteException     {         
            switch (errorCode) {             
                case Definition.ERROR_NOT_ESTIMATE:              //å½“å‰æœªå®šä½              
                    break;              
                case Definition.ERROR_IN_DESTINATION:              //å½“å‰æœºå™¨äººå·²ç»åœ¨ç›®çš„åœ°èŒƒå›´å†…              
                    break;              
                case Definition.ERROR_DESTINATION_NOT_EXIST:              //å¯¼èˆªç›®çš„åœ°ä¸å­˜åœ¨              
                    break;              
                case Definition.ERROR_DESTINATION_CAN_NOT_ARRAIVE://é¿éšœè¶…æ—¶ï¼Œç›®çš„åœ°ä¸èƒ½åˆ°è¾¾ï¼Œè¶…æ—¶æ—¶é—´é€šè¿‡å‚æ•°è®¾ç½®              
                    break;              
                case Definition.ACTION_RESPONSE_ALREADY_RUN:           //å½“å‰æ¥å£å·²ç»è°ƒç”¨ï¼Œè¯·å…ˆåœæ­¢ï¼Œæ‰èƒ½å†æ¬¡è°ƒç”¨                                                                          
                    break;              
                case Definition.ACTION_RESPONSE_REQUEST_RES_ERROR://å·²ç»æœ‰éœ€è¦æ§åˆ¶åº•ç›˜çš„æ¥å£è°ƒç”¨ï¼Œè¯·å…ˆåœæ­¢ï¼Œæ‰èƒ½ç»§ç»­è°ƒç”¨              
                    break;          
            }      
        }
        @Override      
        public void onStatusUpdate(int status, String data, String extraData) {                                 
            switch (status) {               
                case Definition.STATUS_NAVI_AVOID:               //å½“å‰è·¯çº¿å·²ç»è¢«éšœç¢ç‰©å µæ­»               
                    break;                           
                case Definition.STATUS_NAVI_AVOID_END:               //éšœç¢ç‰©å·²ç§»é™¤               
                    break;         
            }      
        }
}
**è°ƒç”¨æ–¹å¼ï¼š**

1. **é»˜è®¤å¯¼èˆªé€Ÿåº¦**
```java
RobotApi.getInstance().startNavigation(reqId, destName, coordinateDeviation, time, navigationListener);
```

2. **é»˜è®¤å¯¼èˆªé€Ÿåº¦ï¼ŒæŒ‡å®šé¿éšœè·ç¦»**ï¼ˆå¦‚æœæ­¤å€¼è®¾ç½®ä¸º 0ï¼Œæœºå™¨äººé»˜è®¤ä¼šä½¿ç”¨é»˜è®¤å€¼ 0.75ï¼‰*è¯¥è°ƒç”¨æ–¹å¼åœ¨V10ç‰ˆæœ¬å¼€å§‹æ”¯æŒ*
```java
RobotApi.getInstance().startNavigation(reqId, destName, coordinateDeviation, obsDistance, time, navigationListener);
```

3. **æŒ‡å®šå¯¼èˆªé€Ÿåº¦** *è¯¥è°ƒç”¨æ–¹å¼åœ¨V4.12ç‰ˆæœ¬å¼€å§‹æ”¯æŒ*
```java
RobotApi.getInstance().startNavigation(reqId, destName, coordinateDeviation, time, linearSpeed, angularSpeed, navigationListener);
```

4. **æŒ‡å®šå¯¼èˆªé€Ÿåº¦ï¼ŒæŒ‡å®šé¿éšœè·ç¦»**ï¼ˆå¦‚æœæ­¤å€¼è®¾ç½®ä¸º 0ï¼Œæœºå™¨äººé»˜è®¤ä¼šä½¿ç”¨é»˜è®¤å€¼ 0.75ï¼‰*è¯¥è°ƒç”¨æ–¹å¼åœ¨V10ç‰ˆæœ¬å¼€å§‹æ”¯æŒ*
```java
RobotApi.getInstance().startNavigation(reqId, destName, coordinateDeviation, obsDistance, time, linearSpeed, angularSpeed, navigationListener);
```

5. **æŒ‡å®šåæ ‡ç‚¹** *è¯¥è°ƒç”¨æ–¹å¼åœ¨V4.12ç‰ˆæœ¬å¼€å§‹æ”¯æŒ*
```java
RobotApi.getInstance().startNavigation(reqId, pose, coordinateDeviation, time, navigationListener);
```

6. **æŒ‡å®šåæ ‡ç‚¹ï¼ŒæŒ‡å®šé¿éšœè·ç¦»**ï¼ˆå¦‚æœæ­¤å€¼è®¾ç½®ä¸º 0ï¼Œæœºå™¨äººé»˜è®¤ä¼šä½¿ç”¨é»˜è®¤å€¼ 0.75ï¼‰*è¯¥è°ƒç”¨æ–¹å¼åœ¨V10ç‰ˆæœ¬å¼€å§‹æ”¯æŒ*
```java
RobotApi.getInstance().startNavigation(reqId, pose, coordinateDeviation, obsDistance, time, navigationListener);
```

7. **æŒ‡å®šå¯¼èˆªåŠ é€Ÿåº¦** *è¯¥è°ƒç”¨æ–¹å¼åœ¨V4.12ç‰ˆæœ¬å¼€å§‹æ”¯æŒ*ï¼ˆæ­¤æ¥å£æš‚æ—¶ä»…æ”¯æŒæ‹›è´¢è±¹ï¼‰
```java
RobotApi.getInstance().startNavigation(reqId, destName, coordinateDeviation, time, linearSpeed, angularSpeed, isAdjustAngle, destinationRange, wheelOverCurrentRetryCount, multipleWaitTime, priority, linearAcceleration, angularAcceleration, navigationListener);
```

**å‚æ•°è¯´æ˜ï¼š**

- `destName`ï¼šå¯¼èˆªç›®çš„åœ°åç§°ï¼ˆå¿…é¡»å…ˆé€šè¿‡setLocationè®¾ç½®ï¼‰
- `pose`ï¼šå¯¼èˆªç›®çš„åœ°åæ ‡ç‚¹
- `obsDistance`ï¼šæœ€å¤§é¿éšœè·ç¦»ï¼Œè·ç¦»ç›®æ ‡çš„éšœç¢ç‰©å°äºè¯¥å€¼æ—¶ï¼Œæœºå™¨äººåœæ­¢ï¼Œå–å€¼å¤§äº 0ï¼Œé»˜è®¤ 0.75ï¼Œå•ä½ç±³ã€‚
- `coordinateDeviation`ï¼šç›®çš„åœ°èŒƒå›´ï¼Œå¦‚æœè·ç¦»ç›®çš„åœ°åœ¨è¯¥èŒƒå›´å†…ï¼Œåˆ™è®¤ä¸ºå·²åˆ°è¾¾ï¼Œå»ºè®®è®¾ç½®ä¸º0.2ï¼Œå•ä½ä¸ºç±³ã€‚
- `time`ï¼šé¿éšœè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¯¥æ—¶é—´å†…æœºå™¨äººçš„ç§»åŠ¨è·ç¦»ä¸è¶…è¿‡0.1mï¼Œåˆ™å¯¼èˆªå¤±è´¥ï¼Œå•ä½æ¯«ç§’ï¼Œå»ºè®®30*1000ã€‚
- `linearSpeed`ï¼šå¯¼èˆªçº¿é€Ÿåº¦ï¼ŒèŒƒå›´ï¼š0.1 ~ 0.85 m/s é»˜è®¤å€¼ï¼š0.7 m/sã€‚
- `angularSpeed`ï¼šå¯¼èˆªè§’é€Ÿåº¦ï¼ŒèŒƒå›´ï¼š0.4 ~ 1.4 m/s é»˜è®¤å€¼ï¼š1.2 m/s æœ€ç»ˆå¯¼èˆªé€Ÿåº¦æ˜¯ç»“åˆçº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦æ¢ç®—åå¾—åˆ°ï¼Œä¸åŒçš„çº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦å¯¹å¯¼èˆªè¿åŠ¨æ–¹å¼æœ‰å½±å“ï¼Œå»ºè®®çº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦ä¿æŒä¸€å®šè§„å¾‹ï¼šangularSpeed = 0.4 + (linearSpeed â€“ 0.1) / 3 * 4
- `isAdjustAngle`ï¼šæ˜¯å¦é€‚åº”å¯¼èˆªç»“æŸæ—¶æœå‘çš„è§’åº¦ã€‚å¦‚ä¼ falseï¼Œåˆ™å½’æ­£åˆ°ç‚¹ä½è®¾ç½®æ—¶çš„è§’åº¦
- `destinationRange`ï¼šç›®æ ‡ç‚¹æ— æ³•åˆ°è¾¾æ—¶ï¼Œè·ç¦»ç›®æ ‡ç‚¹å¤šå°‘è·ç¦»å³è®¤ä¸ºå¯¼èˆªæˆåŠŸ
- `wheelOverCurrentRetryCount`ï¼šå¯¼èˆªè¿‡ç¨‹ä¸­è½®å­å µè½¬å°è¯•æ¬¡æ•°
- `multipleWaitTime`ï¼šå¯¼èˆªè¿‡ç¨‹ä¸­å¦‚é‡å¤šæœºç­‰å¾…
- `priority`ï¼šé»˜è®¤å– 0 å³å¯ï¼Œå–å€¼èŒƒå›´0~30ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼›ä¸€èˆ¬ç”¨äºå¤šä¸ªæœºå™¨äººåœ¨å¯¼èˆªæ—¶å€™é¿è®©ä½¿ç”¨
- `linearAcceleration`ï¼šå¯¼èˆªçº¿åŠ é€Ÿåº¦ï¼ŒèŒƒå›´ï¼š0.4 ~ 0.8 m/s2 é»˜è®¤å€¼ï¼š0.7 m/s2ã€‚
- `angularAcceleration`ï¼šå¯¼èˆªè§’åŠ é€Ÿåº¦ï¼ŒèŒƒå›´ï¼š0.4 ~ 0.9 m/s2 é»˜è®¤å€¼ï¼š0.8 m/s2 æœ€ç»ˆå¯¼èˆªè§’åŠ é€Ÿåº¦é€Ÿåº¦æ˜¯é€šè¿‡çº¿é€Ÿåº¦æ¢ç®—åå¾—åˆ°ï¼Œä¸åŒçš„çº¿åŠ é€Ÿåº¦å’Œè§’åŠ é€Ÿåº¦å¯¹å¯¼èˆªè¿åŠ¨æ–¹å¼æœ‰å½±å“ï¼Œå»ºè®®çº¿åŠ é€Ÿåº¦å’Œè§’åŠ é€Ÿåº¦ä¿æŒä¸€å®šè§„å¾‹ï¼šangularAcceleration= (linearSpeed / 0.8)

> **æ³¨æ„ï¼š** è°ƒç”¨è¯¥æ¥å£å‰éœ€è¦ç¡®ä¿å·²å®šä½

### åœæ­¢å¯¼èˆªåˆ°æŒ‡å®šä½ç½®

**æ–¹æ³•åç§°ï¼š** `stopNavigation`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().stopNavigation(reqId);
```

> **æ³¨æ„ï¼š** è¯¥æ¥å£åªèƒ½ç”¨äºåœæ­¢startNavigationå¯åŠ¨çš„å¯¼èˆª

### å¯¼èˆªåˆ°æŒ‡å®šåæ ‡ç‚¹

> **æ³¨æ„ï¼š** è¯¥æ–¹æ³•å·²ç»åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨startNavigationï¼ŒgoPositionæ¥å£ä¸å†åšç»´æŠ¤

**æ–¹æ³•åç§°ï¼š** `goPosition`

**ç»“æœå›è°ƒï¼š**

```java
CommandListener goPositionListener = new CommandListener() {
    @Override
    public void onResult(int status, String response) {
        switch (status) {
            case Definition.RESULT_OK:
                if ("true".equals(response)) {
                    //å¯¼èˆªæˆåŠŸ
                } else {
                    //å¯¼èˆªå¤±è´¥
                }
                break;
        }
    }
    @Override
    public void onError(int errorCode, String errorString) throws RemoteException {
        switch (errorCode) {
            case Definition.ACTION_RESPONSE_ALREADY_RUN:
                //å½“å‰æ¥å£å·²ç»è°ƒç”¨ï¼Œè¯·å…ˆåœæ­¢ï¼Œæ‰èƒ½å†æ¬¡è°ƒç”¨
                break;
            case Definition.ACTION_RESPONSE_REQUEST_RES_ERROR:
                //å·²ç»æœ‰éœ€è¦æ§åˆ¶åº•ç›˜çš„æ¥å£è°ƒç”¨ï¼Œè¯·å…ˆåœæ­¢ï¼Œæ‰èƒ½ç»§ç»­è°ƒç”¨
                break;
        }
    }
    @Override 
    public void onStatusUpdate(int status, String data) {
        switch (status) {
            case Definition.STATUS_NAVI_AVOID:
                //å½“å‰è·¯çº¿å·²ç»è¢«éšœç¢ç‰©å µæ­»
                break;
            case Definition.STATUS_NAVI_AVOID_END:
                //éšœç¢ç‰©å·²ç§»é™¤
                break;
        }
    }
};
```

**è°ƒç”¨æ–¹å¼ï¼š**

1. **é»˜è®¤é€Ÿåº¦**

```java
try {
    JSONObject position = new JSONObject();
    //xåæ ‡
    position.put(Definition.JSON_NAVI_POSITION_X, x);
    //yåæ ‡
    position.put(Definition.JSON_NAVI_POSITION_Y, y);
    //zåæ ‡
    position.put(Definition.JSON_NAVI_POSITION_THETA, theta);
    RobotApi.getInstance().goPosition(reqId, position.toString(), goPositionListener);
} catch (JSONException e) {
    e.printStackTrace();
}
```

2. **æŒ‡å®šé€Ÿåº¦** *è¯¥è°ƒç”¨æ–¹å¼åœ¨V4.12ç‰ˆæœ¬å¼€å§‹æ”¯æŒ*

```java
try {
    JSONObject position = new JSONObject();
    //xåæ ‡
    position.put(Definition.JSON_NAVI_POSITION_X, x);
    //yåæ ‡
    position.put(Definition.JSON_NAVI_POSITION_Y, y);
    //zåæ ‡
    position.put(Definition.JSON_NAVI_POSITION_THETA, theta);
    RobotApi.getInstance().goPosition(reqId, position.toString(), linearSpeed, angularSpeed, goPositionListener);
} catch (JSONException e) {
    e.printStackTrace();
}
```

**å‚æ•°è¯´æ˜ï¼š**

- `position`ï¼šå‚æ•°ä¸ºjsonæ ¼å¼çš„åæ ‡ç‚¹ `{ "x": "xåæ ‡", "y": "yåæ ‡", "theta": "zåæ ‡" }`
- `linearSpeed`ï¼šå¯¼èˆªçº¿é€Ÿåº¦ï¼ŒèŒƒå›´ï¼š0.1 ~ 0.85 m/s é»˜è®¤å€¼ï¼š0.7 m/s
- `angularSpeed`ï¼šå¯¼èˆªè§’é€Ÿåº¦ï¼ŒèŒƒå›´ï¼š0.4 ~ 1.4 m/s é»˜è®¤å€¼ï¼š1.2 m/s

> **æ³¨æ„ï¼š** æœ€ç»ˆå¯¼èˆªé€Ÿåº¦æ˜¯ç»“åˆçº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦æ¢ç®—åå¾—åˆ°ï¼Œä¸åŒçš„çº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦å¯¹å¯¼èˆªè¿åŠ¨æ–¹å¼æœ‰å½±å“ï¼Œå»ºè®®çº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦ä¿æŒä¸€å®šè§„å¾‹ï¼šangularSpeed = 0.4 + (linearSpeed â€“ 0.1) / 3 * 4

> **æ³¨æ„ï¼š** è°ƒç”¨è¯¥æ¥å£å‰éœ€è¦ç¡®ä¿å·²å®šä½

### åœæ­¢å¯¼èˆªåˆ°æŒ‡å®šåæ ‡ç‚¹

**æ–¹æ³•åç§°ï¼š** `stopGoPosition`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().stopGoPosition(reqId);
```

> **æ³¨æ„ï¼š** goPosition ä¸ startNavigation ä¸¤ä¸ªå¯åŠ¨å¯¼èˆªçš„æ¥å£ï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„åœæ­¢æ¥å£ï¼Œå¿…é¡»ä¸€ä¸€å¯¹åº”ï¼Œä¸èƒ½æ··ç”¨

---

### è½¬å‘ç›®æ ‡ç‚¹æ–¹å‘

**æ–¹æ³•åç§°ï¼š** `resumeSpecialPlaceTheta`

**æ–¹æ³•è¯´æ˜ï¼š** è¯¥æ¥å£åªä¼šå·¦å³è½¬åŠ¨åˆ°ç›®æ ‡ç‚¹æ–¹ä½ï¼Œä¸ä¼šå®é™…è¿åŠ¨åˆ°ç›®æ ‡ç‚¹ã€‚

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().resumeSpecialPlaceTheta(reqId,
    placeName,
    new CommandListener() {
        @Override
        public void onResponse(int result, String message) {
        }
    });
```

**å‚æ•°è¯´æ˜ï¼š**

- `reqId`ï¼šintç±»å‹ å‘½ä»¤id
- `placeName`ï¼šStringç±»å‹ ç›®æ ‡ç‚¹åç§°
- `listener`ï¼šCommandListenerç±»å‹ æ¶ˆæ¯å›è°ƒ

**è¿”å›å€¼ï¼š**

- `int result`ï¼š0 å‘½ä»¤æ‰§è¡Œ / -1 æ²¡æœ‰æ‰§è¡Œ

> **æ³¨æ„ï¼š** è°ƒç”¨è¯¥æ¥å£å‰éœ€è¦ç¡®ä¿å·²å®šä½

### è®¡ç®—å·¡çº¿æ¨¡å¼ä¸‹ï¼Œä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»

ä½¿ç”¨è¿™ä¸ªAPIå¯ä»¥è·å–åˆ°ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆä»…ç”¨äºè®¡ç®—åœ¨å·¡çº¿æ¨¡å¼ä¸‹ï¼Œå·¡çº¿è·¯å¾„ä¸Šçš„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»ï¼‰

**æ–¹æ³•åç§°ï¼š** `getNaviPathInfo`

**æ–¹æ³•è¯´æ˜ï¼š** ç”¨äºè®¡ç®—åœ¨å·¡çº¿æ¨¡å¼ä¸‹ï¼Œå·¡çº¿è·¯å¾„ä¸Šçš„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»ã€‚ä¼ å…¥çš„ç‚¹ä½ä¿¡æ¯å¯ä»¥æ˜¯å·¡çº¿è·¯å¾„ä¸Šçš„ä»»æ„ç‚¹ï¼Œå¯é€šè¿‡è·å–ç‚¹ä½çš„APIæ¥è·å–åœ°å›¾ä¸Šæ ‡å®šçš„ç‚¹ä½çš„ä¿¡æ¯ã€‚

**è°ƒç”¨æ–¹å¼ï¼š**

```java
// èµ·ç‚¹å’Œç»ˆç‚¹éƒ½å¿…é¡»åœ¨å·¡çº¿è·¯ç»ä¸Šï¼Œæœºå™¨äººå¼€å¯å·¡çº¿æ¨¡å¼
Pose startPos = new Pose();
startPos.setX(-0.22329703f);
startPos.setY(1.1073834f);
startPos.setTheta(-1.2297891f);

Pose endPos = new Pose();
endPos.setX(0.09533833f);
endPos.setY(-0.7406802f);
endPos.setTheta(-2.886187f);

// ä½¿ç”¨è¿™ä¸ªAPIè·å–è·¯å¾„é•¿åº¦ï¼Œå•ä½ç±³
RobotApi.getInstance().getNaviPathInfo(reqID,
    startPos,
    endPos,
    new CommandListener() {
        @Override
        public void onResult(int status, String response, String extraData) {
            try {
                JSONObject json = new JSONObject(response);
                double pathLength = json.getDouble("pathLength");
            } catch (JSONException e) {
                e.printStackTrace();
            }
        }
        
        @Override
        public void onError(int errorCode, String errorString, String extraData) {
            Log.d("OnError", errorCode);
        }
    });
```
---

### è®¾ç½®æœºå™¨äººåŠ é€Ÿå‡é€Ÿæ¨¡å¼

å¼€å‘æ‹›è´¢è±¹æ—¶ï¼Œå¯å¯¹æœºå™¨äººåŠ é€Ÿå’Œåˆ¹è½¦åŠ é€Ÿåº¦è¿›è¡Œå…¨å±€è®¾ç½®ï¼Œä»¥é€‚åº”å½“å‰çš„ä¸šåŠ¡éœ€æ±‚ã€‚è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

#### 1. åœ¨APPä¸­æ·»åŠ æƒé™

```xml
<uses-permission android:name="com.ainirobot.coreservice.robotSettingProvider" />
```

#### 2. åœ¨ä»£ç ä¸­ä½¿ç”¨æ–¹æ³•æ¥æ›´æ”¹è®¾ç½®

```java
public class NavigationSettings {
    // value "1" - "3": 1æŸ”å’Œ 2æ­£å¸¸ 3æ€¥è¿«
    public static final String ROBOT_SETTING_NAVIGATION_BREAK_MODE_LEVEL = "robot_setting_navigation_break_mode_level";
    // value "1" - "3": 1æŸ”å’Œ 2æ­£å¸¸ 3æ€¥è¿«
    public static final String ROBOT_SETTING_NAVIGATION_START_MODE_LEVEL = "robot_setting_navigation_start_mode_level";
    
    public NavigationSettings() {
    }
    
    public void setBreakModeLevel(int i) {
        i = i > 3 ? 3 : Math.max(i, 1);
        putString(ROBOT_SETTING_NAVIGATION_BREAK_MODE_LEVEL, "" + i);
    }
    
    public void setStartModeLevel(int i) {
        i = i > 3 ? 3 : Math.max(i, 1);
        putString(ROBOT_SETTING_NAVIGATION_START_MODE_LEVEL, "" + i);
    }
    
    private void putString(String key, String value) {
        if (value.equals("")) {
            return;
        }
        try {
            sendSettingBroadcast(key, value);
            // Settings.Global.putString(mContext.getContentResolver(), key, value);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    private void sendSettingBroadcast(String key, String value) {
        RobotSettingApi.getInstance().setRobotString(key, value);
    }
}
```

## æ¢¯æ§å¯¼èˆª

### ä»‹ç»

æ¢¯æ§å¯¼èˆªæŒ‡æœºå™¨äººçš„è¡Œèµ°èƒ½åŠ›ï¼Œæœºå™¨äººå¯ä»¥ä»Aç‚¹è¡ŒåŠ¨è‡³Bç‚¹ï¼Œè¡Œèµ°è¿‡ç¨‹ä¸­å¯ä»¥è‡ªåŠ¨è§„åˆ’è·¯çº¿ï¼Œä¸åŒæ¥¼å±‚è‡ªåŠ¨åˆ‡æ¢åœ°å›¾ï¼Œå¯ä»¥æœ‰æ•ˆé¿å¼€éšœç¢ç‰©ã€‚

æœºå™¨äººå¯¼èˆªæ‰€ä½¿ç”¨çš„ä¼ æ„Ÿå™¨æ¯”è¾ƒå¤šï¼ŒåŒ…æ‹¬åº•éƒ¨æ¿€å…‰é›·è¾¾ï¼ŒRGBDï¼Œå¤´éƒ¨IRä¼ æ„Ÿå™¨ï¼ˆéƒ¨åˆ†æœºå‹ï¼‰ç­‰ï¼Œæ‰€ä»¥åœ¨å¯¼èˆªä¸­è¯·ä¸è¦é®æŒ¡è¿™äº›ä¼ æ„Ÿå™¨ï¼Œä»¥å…å‡ºç°æœºå™¨äººä¸èµ°ï¼Œè·¯å¾„è§„åˆ’å¤±è´¥ç­‰é—®é¢˜ã€‚

**æœºå™¨äººèƒ½æ‰§è¡Œå¯¼èˆªåŠ¨ä½œçš„å‰ææ¡ä»¶ï¼š**

- æœºå™¨äººå·²æ–°å»ºåœ°å›¾ï¼Œå¹¶ä¸”åœ¨è¯¥åœ°å›¾ä¸Šå·²ç»å®šä½æˆåŠŸ
- æœºå™¨äººå¿…é¡»å»ºç«‹å·¡çº¿
- æœºå™¨äººå¿…é¡»å¤„äºå·¡çº¿çš„ç‚¹ä½ä¹‹ä¸Š
- æœºå™¨äººçš„åœ°å›¾ä¸èƒ½ä½¿ç”¨å¤åˆ¶çš„åœ°å›¾ï¼Œä¼šé€ æˆç‚¹ä½IDï¼Œæ¥¼å±‚å†²çªï¼Œæ— æ³•åˆ°è¾¾
- é›·è¾¾å¤„äºå¼€å¯çŠ¶æ€
- ä»…æ”¯æŒæ¢¯æ§æœºå™¨äºº

> **é‡è¦æç¤ºï¼š** è¯·ä¸€å®šè¦æ³¨æ„ä»¥ä¸Šå‰ææ¡ä»¶ï¼

> **æ³¨æ„ï¼š** ä½¿ç”¨å¡é«˜æ¢¯æ§ ROM éœ€è¦10.3åŠä»¥ä¸Šï¼›ä½¿ç”¨è‡ªç ”æ¢¯æ§ ROM éœ€è¦10.5åŠä»¥ä¸Šã€‚å½“å‰æœºå™¨ä½¿ç”¨æ¢¯æ§ç±»å‹è¯·å’¨è¯¢å”®å‰ã€‚

### è·å–å¤šåœ°å›¾ç‚¹ä½æ•°æ®ä¿¡æ¯

**æ–¹æ³•åç§°ï¼š** `getMultiFloorConfigAndPose`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
// è·å–å¤šåœ°å›¾ç‚¹ä½åˆ—è¡¨
RobotApi.getInstance().getMultiFloorConfigAndPose(Definition.DEBUG_REQ_ID, new CommandListener() {
    @Override
    public void onResult(int result, String message, String extraData) {
        Type type = new TypeToken<ArrayList<MultiFloorInfo>>() {
        }.getType();
        try {
            Log.d(TAG, "initAllMapInfo: " + result + " msg:" + message);
            mDatas = new Gson().fromJson(message, type);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
});
```
### å¯¼èˆªåˆ°æŒ‡å®šä½ç½®

**æ–¹æ³•åç§°ï¼š** `startElevatorNavigation`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().startElevatorNavigation(Definition.DEBUG_REQ_ID,
        dest,
        floor,
        new ActionListener() {
            @Override
            public void onResult(int status, String message, String extraData) throws RemoteException {
                Log.e("mName", "onResult: " + status + " responseStringï¼š" + message + " extraDataï¼š" + extraData);
                handlerResult(status, message, extraData);
            }
            
            @Override
            public void onError(int errorCode, String errorString, String extraData) throws RemoteException {
                Log.e("mName", "onError: " + errorCode + " errorStringï¼š" + errorString + " extraDataï¼š" + extraData);
                handlerError(errorCode, errorString, extraData);
            }
            
            @Override
            public void onStatusUpdate(int status, String data, String extraData) throws RemoteException {
                Log.e("mName", "onStatusUpdate: " + status + " dataï¼š" + data + " extraDataï¼š" + extraData);
                handlerStatusUpdate(status, data, extraData);
            }
        });
```
**handlerResult æ–¹æ³•ï¼š**

```java
private void handlerResult(int status, String message, String extraData) {
    switch (status) {
        case Definition.RESULT_OK:
            // stop(ComponentResult.RESULT_NAVIGATION_ARRIVED, message, extraData);
            break;
        case Definition.ACTION_RESPONSE_STOP_SUCCESS:
            // stop(status, message + " åœæ­¢æˆåŠŸ", extraData);
            break;
        case Definition.RESULT_FAILURE:
            // stop(status, message + " å¯¼èˆªå¤±è´¥", extraData);
            break;
        case Definition.STATUS_NAVI_OUT_MAP:
            // stop(ComponentError.ERROR_NAVIGATION_OUT_MAP, message, extraData);
            break;
        case Definition.STATUS_NAVI_GLOBAL_PATH_FAILED:
            // stop(ComponentError.ERROR_NAVIGATION_GLOBAL_PATH_FAILED, message, extraData);
            break;
        case Definition.STATUS_NAVI_MULTI_MAP_NOT_MATCH:
        case Definition.STATUS_NAVI_MULTI_LORA_DISCONNECT:
        case Definition.STATUS_NAVI_MULTI_LORA_CONFIG_FAIL:
        case Definition.STATUS_NAVI_MULTI_VERSION_NOT_MATCH:
            // stop(ComponentError.ERROR_MULTIPLE_MODE_ERROR, message, extraData);
            break;
        case Definition.STATUS_NAVI_WHEEL_SLIP:
            // stop(ComponentError.ERROR_NAVI_WHEEL_SLIP, message, extraData);
            break;
        default:
            // stop(status, message, extraData);
            break;
    }
}
```
**handlerError æ–¹æ³•ï¼š**

```java
private void handlerError(int errorCode, String message, String extraData) {
    switch (errorCode) {
        case Definition.ERROR_NOT_ESTIMATE:
            // stop(ComponentError.ERROR_NOT_ESTIMATE, "navigation not estimate", extraData);
            break;
        case Definition.ERROR_IN_DESTINATION:
            // stop(ComponentError.ERROR_NAVIGATION_ALREADY_IN_DESTINATION, "already in destination", extraData);
            break;
        case Definition.ERROR_DESTINATION_NOT_EXIST:
            // stop(ComponentError.ERROR_DESTINATION_NOT_EXIST, "destination not exist", extraData);
            break;
        case Definition.ERROR_DESTINATION_CAN_NOT_ARRAIVE:
            // stop(ComponentError.ERROR_DESTINATION_CAN_NOT_ARRIVE, "navigation moving time out", extraData);
            break;
        case Definition.ERROR_MULTI_ROBOT_WAITING_TIMEOUT:
            // stop(ComponentError.ERROR_MULTI_ROBOT_WAITING_TIMEOUT);
            break;
        case Definition.ERROR_NAVIGATION_AVOID_TIMEOUT:
            // stop(ComponentError.ERROR_NAVIGATION_AVOID_TIMEOUT, "navigation avoid time out", "");
        case Definition.ACTION_RESPONSE_ALREADY_RUN:
            // stop(ComponentError.ERROR_REQUEST_RES_BUSY);
            break;
        case Definition.ACTION_RESPONSE_REQUEST_RES_ERROR:
            // stop(ComponentError.ERROR_REQUEST_RES_FAILED);
            break;
        case Definition.ERROR_WHEEL_OVER_CURRENT_RUN_OUT:
            // stop(ComponentError.ERROR_WHEEL_OVER_CURRENT_RUN_OUT, "wheel over current retry count run out", extraData);
            break;
        case Definition.ACTION_RESPONSE_RES_UNAVAILBALE:
            // stop(ComponentError.ERROR_OPEN_RADAR_FAILED, "res unavailable: " + message, extraData);
            break;
        default:
            // stop(errorCode, message, extraData);
            break;
    }
}
```
**handlerStatusUpdate æ–¹æ³•ï¼š**

```java
private void handlerStatusUpdate(int status, String data, String extraData) {
    switch (status) {
        case Definition.STATUS_GOAL_OCCLUDED:
        case Definition.STATUS_NAVI_AVOID:
            // updateStatus(ComponentStatus.STATUS_NAVIGATION_AVOID_START,"navigation avoid start", extraData);
            break;
        case Definition.STATUS_GOAL_OCCLUDED_END:
        case Definition.STATUS_NAVI_AVOID_END:
            // updateStatus(ComponentStatus.STATUS_NAVIGATION_AVOID_END,"navigation avoid end", extraData);
            break;
        case Definition.STATUS_NAVI_OBSTACLES_AVOID:
            // updateStatus(ComponentStatus.STATUS_OBSTACLES_AVOID,"pause to obstacles avoid", extraData);
            break;
        case Definition.STATUS_START_NAVIGATION:
            // updateStatus(ComponentStatus.STATUS_START_NAVIGATION,"start navigation");
            break;
        case Definition.STATUS_NAVI_MULTI_ROBOT_WAITING:
            // updateStatus(ComponentStatus.STATUS_NAVI_MULTI_ROBOT_WAITING,"navigation multi robot waiting");
            break;
        case Definition.STATUS_NAVI_MULTI_ROBOT_WAITING_END:
            // updateStatus(ComponentStatus.STATUS_NAVI_MULTI_ROBOT_WAITING_END,"navigation multi robot waiting end");
            break;
        case Definition.STATUS_NAVI_GO_STRAIGHT:
            // updateStatus(ComponentStatus.STATUS_NAVIGATION_GO_STRAIGHT, data,extraData);
            break;
        case Definition.STATUS_NAVI_TURN_LEFT:
            // updateStatus(ComponentStatus.STATUS_NAVIGATION_TURN_LEFT, data, extraData);
            break;
        case Definition.STATUS_NAVI_TURN_RIGHT:
            // updateStatus(ComponentStatus.STATUS_NAVIGATION_TURN_RIGHT, data, extraData);
            break;
        case Definition.STATUS_NAVI_SET_PRIORITY_FAILED:
            // updateStatus(ComponentStatus.STATUS_NAVIGATION_SET_PRIORITY_FAILED, data, extraData);
            break;
        default:
            // updateStatus(status, data, extraData);
            break;
    }
}
```
**å‚æ•°è¯´æ˜ï¼š**

- `definition.DEBUG_REQ_ID`ï¼šintç±»å‹ï¼Œå‘½ä»¤idï¼Œå®šä¹‰å‚æ•°reqid
- `dest`ï¼šstringç±»å‹ï¼Œæœ¬æ¬¡å¯¼èˆªç›®çš„åœ°ï¼Œç›®çš„åœ°ä¸ä¸ºç©ºï¼Œä¸”æ˜¯ç›®æ ‡æ¥¼å±‚åœ°å›¾ä¸Šæ‰€åœ¨çš„ç‚¹
- `floor`ï¼šintç±»å‹ï¼Œç›®çš„åœ°æ‰€åœ¨æ¥¼å±‚æ˜ å°„ï¼Œç›®çš„åœ°æ¥¼å±‚çš„æ¥¼å±‚æ˜ å°„ï¼ˆFloorIndexï¼‰ï¼Œä¸èƒ½ä¸º0ï¼Œä¸”éœ€åœ¨MapToolå¤šå±‚ç®¡ç†çš„åœ°å›¾ç»„ä¸­
- `listener`ï¼šActionListenerç±»å‹ï¼ŒåŠŸèƒ½ç›‘å¬ï¼Œéœ€è¦çš„å›è°ƒï¼šonResultã€onErrorã€onStatusUpdate

> **æ³¨æ„ï¼š** è°ƒç”¨è¯¥æ¥å£å‰éœ€è¦ç¡®ä¿å·²å®šä½

### åœæ­¢å¯¼èˆªåˆ°æŒ‡å®šä½ç½®

**æ–¹æ³•åç§°ï¼š** `stopAdvanceNavigation`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().stopAdvanceNavigation(reqId);
```

> **æ³¨æ„ï¼š** è¯¥æ¥å£åªèƒ½ç”¨äºåœæ­¢startElevatorNavigationå¯åŠ¨çš„å¯¼èˆª

---

### çŠ¶æ€å’Œé”™è¯¯ç å®šä¹‰

#### onStatusUpdate
å¯¼èˆªè¿‡ç¨‹ä¸­ä¸ŠæŠ¥çš„äº‹ä»¶ï¼Œä¸ŠæŠ¥æ—¶ä»»åŠ¡ä¸ä¼šåœæ­¢ã€‚

| åç§° | Code | å®šä¹‰ |
|------|------|------|
| `STATUS_START_NAVIGATION` | 1014 | å¯¼èˆªå¼€å§‹ |
| `STATUS_NAVI_REPLACE_DESTINATION` | 1048 | åˆ‡æ¢ç›®çš„åœ°å¹¶å¼€å§‹å¯¼èˆª |
| `STATUS_ESTIMATE_LOST` | 1045 | å®šä½ä¸¢å¤± |
| `STATUS_DISTANCE_WITH_DESTINATION` | 1050 | è·ç›®çš„åœ°è·ç¦»,å•ä½ï¼ˆmï¼‰ä¾‹ï¼šextraData = "3" |
| `STATUS_NAVI_AVOID_IMMEDIATELY` | 1051 | é¿éšœ |
| `STATUS_GOAL_OCCLUDED` | 1016 | é¿éšœå¼€å§‹ |
| `STATUS_NAVI_AVOID` | 1018 | é¿éšœ |
| `STATUS_GOAL_OCCLUDED_END` | 1017 | é¿éšœç»“æŸ |
| `STATUS_NAVI_AVOID_END` | 1019 | é¿éšœç»“æŸ |
| `STATUS_NAVI_OBSTACLES_AVOID` | 1023 | éšœç¢ç‰©é¿éšœ |
| `STATUS_NAVI_MULTI_ROBOT_WAITING` | 1034 | å¼€å§‹ç­‰å¾…å…¶ä»–æœºå™¨äººé€šè¿‡ï¼ˆå¤šæœºé¿éšœå¼€å§‹ï¼‰ |
| `STATUS_NAVI_MULTI_ROBOT_WAITING_END` | 1035 | å¤šæœºé¿éšœç»“æŸ |
| `STATUS_NAVI_GO_STRAIGHT` | 1036 | æœºå™¨äººåœ¨ç›´çº¿ä¸Šè¡Œèµ° |
| `STATUS_NAVI_TURN_LEFT` | 1037 | æœºå™¨äººå·¦è½¬ |
| `STATUS_NAVI_TURN_RIGHT` | 1038 | æœºå™¨äººå³è½¬ |

#### onResult

å¯¼èˆªåŠŸèƒ½ç»“æŸæ—¶ï¼Œä¸ŠæŠ¥çš„çŠ¶æ€

| åç§° | Code | å®šä¹‰ |
|------|------|------|
| `RESULT_NAVIGATION_ARRIVED` | 102 | åˆ°è¾¾ç›®çš„åœ° |
| `RESULT_OK` | 1 | æˆåŠŸ |
| `RESULT_FAILURE` | 2 | å¯¼èˆªå¤±è´¥ |
| `RESULT_DESTINATION_AVAILABLE` | 103 | ç›®çš„åœ°å¯è¾¾ï¼Œæœªè¢«å ç”¨ |
| `RESULT_DESTINATION_IN_RANGE` | 104 | åˆ°è¾¾ç›®çš„åœ°èŒƒå›´å†… |
| `ACTION_RESPONSE_STOP_SUCCESS` | 3 | actionåœæ­¢æˆåŠŸ |
| `STATUS_NAVI_OUT_MAP` | 1020 | è¶…å‡ºåœ°å›¾èŒƒå›´ |
| `STATUS_NAVI_GLOBAL_PATH_FAILED` | 1025 | å¯¼èˆªè·¯å¾„è§„åˆ’å¤±è´¥ |
| `STATUS_NAVI_MULTI_MAP_NOT_MATCH` | 1040 | å¤šæœºåœ°å›¾æœªåŒ¹é… |
| `STATUS_NAVI_MULTI_LORA_DISCONNECT` | 1041 | å¤šæœºloraæ–­å¼€è¿æ¥ |
| `STATUS_NAVI_MULTI_LORA_CONFIG_FAIL` | 1042 | å¤šæœºé…ç½®æœ‰é—®é¢˜ |
| `STATUS_NAVI_MULTI_VERSION_NOT_MATCH` | 1043 | è§†è§‰æœªåŒ¹é… |
| `STATUS_NAVI_WHEEL_SLIP` | 1044 | å¯¼èˆªæ—¶è½®å­æ‰“æ»‘ |

#### onError

å¯¼èˆªå‡ºç°å¼‚å¸¸ç»“æŸæ—¶ï¼Œä¸ŠæŠ¥çš„çŠ¶æ€

| åç§° | Code | å®šä¹‰ |
|------|------|------|
| `ERROR_PARAMETER` | -102 | å‚æ•°é”™è¯¯ |
| `ERROR_TARGET_NOT_FOUND` | -107 | æœªæ‰¾åˆ°ç‚¹ä½ |
| `ERROR_DESTINATION_NOT_EXIST` | -108 | ç›®çš„åœ°ä¸å­˜åœ¨ |
| `ERROR_ESTIMATE_ERROR` | -128 | é‡å®šä½å¤±è´¥ |
| `ERROR_MULTIPLE_MODE_ERROR` | -127 | å¤šæœºä¿¡æ¯é”™è¯¯ |
| `ERROR_PARAMS_JSON_PARSER_ERROR` | -32750026 | jsonè§£æé”™è¯¯ |
| `ERROR_NO_AVAILABLE_DESTINATION` | -129 | æœªæ‰¾åˆ°å¯ç”¨çš„ç›®çš„åœ° |
| `ERROR_NOT_ESTIMATE` | -116 | æœªå®šä½ |
| `ERROR_IN_DESTINATION` | -113 | å·²ç»åœ¨ç›®çš„åœ° |
| `ERROR_DESTINATION_CAN_NOT_ARRAIVE` | -109 | ç›®çš„åœ°ä¸å¯è¾¾ |
| `ERROR_MULTI_ROBOT_WAITING_TIMEOUT` | -125 | å¤šæœºé¿éšœç­‰å¾…è¶…æ—¶ |
| `ERROR_NAVIGATION_AVOID_TIMEOUT` | -136 | æœºå™¨äººé¿éšœè¶…æ—¶ |
| `ACTION_RESPONSE_ALREADY_RUN` | -1 | Request busy |
| `ACTION_RESPONSE_REQUEST_RES_ERROR` | -6 | è¯·æ±‚å¤±è´¥ |
| `ACTION_RESPONSE_RES_UNAVAILBALE` | -9 | è¯·æ±‚ä¸å¯ç”¨ |
| `ERROR_WHEEL_OVER_CURRENT_RUN_OUT` | -124 | è½®å­å µè½¬é‡è¯•æ¬¡æ•°ç”¨å®Œ |

### æ¢¯æ§ç¤ºä¾‹åœ°å€

> **æ³¨æ„ï¼š** å…·ä½“çš„æ¢¯æ§ç¤ºä¾‹ä»£ç å’Œä½¿ç”¨è¯´æ˜ï¼Œè¯·å‚è€ƒç›¸å…³çš„ç¤ºä¾‹é¡¹ç›®ã€‚

## è¿‡é—¸æœºå¯¼èˆª

### ä»‹ç»

ä»¥ä¸‹æ˜¯å…³äºæœºå™¨äººè¿‡é—¸æœºçš„ API ä»‹ç»ï¼Œä½¿ç”¨ API éœ€è¦æœ‰ä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼š

**å‡†å¤‡å·¥ä½œï¼š**

- æœºå™¨ç¡¬ä»¶æ”¯æŒè¿‡é—¸æœº
- è®¾ç½®é—¸æœºçº¿
- å»ºå›¾æ—¶è¦è®¾ç½®"é—¸æœºå…¥å£"å’Œ"é—¸æœºå‡ºå£"ä¸¤ä¸ªç‚¹ä½ï¼Œç‚¹ä½åå­—å¼ºåŒ¹é…
- è®¾ç½®å·¡çº¿ï¼Œè¦ä¿è¯é—¸æœºå…¥å£å’Œé—¸æœºå‡ºå£ï¼Œæœ‰å”¯ä¸€ä¸€æ¡å·¡çº¿å¯é€šè¿‡ï¼Œè¯¥å·¡çº¿éœ€è¦æ˜¯åŒå‘çº¿
- å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œé€‰æ‹©ç¼–è¾‘åœ°å›¾ï¼Œé—¸æœºçº¿é€‰é¡¹ï¼Œå¯é€‰æ‹©ä¸€æ¡å·¡çº¿ä½œä¸ºé—¸æœºçº¿ï¼Œé€‰æ‹©åä¿å­˜å¹¶ä¸”ä¸Šä¼ äº‘ç«¯

> **æ³¨æ„ï¼š** é—¸æœºçº¿ç›®å‰æ˜¯æ•´æœºå”¯ä¸€ï¼Œæ²¡æœ‰ä¸åœ°å›¾çš„å…³è”å…³ç³»ï¼Œåˆ‡æ¢åœ°å›¾åè¦é‡æ–°è®¾ç½®

### åˆ¤æ–­ä»å½“å‰ä½ç½®åˆ°ç›®æ ‡ç‚¹ä½æ˜¯å¦é€šè¿‡é—¸æœº

**æ–¹æ³•åç§°ï¼š** `getGatePassingRoute`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().getGatePassingRoute(reqId, targetPlaceName, new CommandListener() {
    @Override
    public void onResult(int result, String message) {
        // å¤„ç†è¿”å›ç»“æœ
        // å¦‚æœè¿”å›çš„List<Pose>ä¸ºç©ºï¼Œåˆ™ä¸éœ€è¦ç»è¿‡é—¸æœº
        // å¦‚æœéç©ºï¼Œåˆ™ä¸¤ä¸ªç‚¹å³ä¸ºåœ°å›¾é‡Œå»ºç«‹çš„"é—¸æœºå…¥å£"å’Œ"é—¸æœºå‡ºå£"çš„ç‚¹
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `reqId`ï¼šå‘½ä»¤id
- `targetPlaceName`ï¼šæœºå™¨äººè¦å¯¼èˆªå»çš„ç›®æ ‡ç‚¹åç§°
- `listener`ï¼šå›è°ƒï¼Œå¯ä»¥è¿”å›ä¸€ä¸ª`List<Pose>`ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™ä¸éœ€è¦ç»è¿‡é—¸æœºï¼Œå¦‚æœéç©ºï¼Œåˆ™ä¸¤ä¸ªç‚¹å³ä¸ºåœ°å›¾é‡Œå»ºç«‹çš„"é—¸æœºå…¥å£"å’Œ"é—¸æœºå‡ºå£"çš„ç‚¹

> **æ³¨æ„ï¼š** è¯¦ç»†ä½¿ç”¨å‚è€ƒ Demo

### å¯¼èˆªé€šè¿‡é—¸æœº

é€šè¿‡ `getGatePassingRoute` åˆ¤æ–­éœ€è¦é€šè¿‡é—¸æœºï¼Œåˆ™å¯¼èˆªåˆ°ç¦»æœºå™¨äººæœ€è¿‘çš„ä¸€ä¸ªç‚¹ï¼ˆä¸Šä¸€æ­¥æŸ¥è¯¢å¾—åˆ°çš„ç‚¹ï¼‰ï¼Œç„¶åå†æ§åˆ¶é—¸æœºå¼€é—¨ï¼ˆç›®å‰å®¢æˆ·è‡ªå·±å®ç°ï¼‰ï¼Œå¼€é—¨æˆåŠŸåï¼Œå¯¼èˆªåˆ°ç›®çš„åœ°ã€‚

**å®ç°æµç¨‹ï¼š**

1. è°ƒç”¨ `getGatePassingRoute` åˆ¤æ–­æ˜¯å¦éœ€è¦ç»è¿‡é—¸æœº
2. å¦‚æœéœ€è¦ç»è¿‡é—¸æœºï¼Œå¯¼èˆªåˆ°ç¦»æœºå™¨äººæœ€è¿‘çš„ç‚¹ä½ï¼ˆé—¸æœºå…¥å£æˆ–å‡ºå£ï¼‰
3. æ§åˆ¶é—¸æœºå¼€é—¨ï¼ˆéœ€è¦å®¢æˆ·è‡ªå·±å®ç°ï¼‰
4. å¼€é—¨æˆåŠŸåï¼Œå¯¼èˆªåˆ°æœ€ç»ˆç›®çš„åœ°

## åŸºç¡€åœºæ™¯

### ç®€ä»‹

åŸºç¡€åœºæ™¯æ˜¯RobotOSæä¾›çš„åŠŸèƒ½ç»„ä»¶ï¼ŒæŒ‡åŒ…å«ä¸€ç³»åˆ—åŠŸèƒ½ç­–ç•¥çš„åœºæ™¯åŠŸèƒ½ï¼Œä½¿ç”¨åœºæ™¯Apiå¯ä»¥å¿«é€Ÿå®ç°è­¬å¦‚å¼•é¢†ï¼Œæ³¨å†Œç­‰åŸºç¡€èƒ½åŠ›ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­çš„åŠŸèƒ½çŠ¶æ€é€šè¿‡å›è°ƒå‡½æ•°å‘ŠçŸ¥è°ƒç”¨ä¾§ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å‚ä¸å†³ç­–ã€‚

## å¼•é¢†

### åœºæ™¯ä»‹ç»

å¼•é¢†æ˜¯æ–¹ä¾¿ç”¨æˆ·äºŒæ¬¡å¼€å‘è€Œå®ç°çš„ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡åœºæ™¯ï¼Œå†…éƒ¨é›†æˆäº†äººè„¸è¯†åˆ«å’Œå¯¼èˆªï¼Œå¯åœ¨å¯¼èˆªä¸­æŒç»­è¯†åˆ«å¼•é¢†ç›®æ ‡ï¼Œå¹¶å¯å®æ—¶ä¸ŠæŠ¥å¼•é¢†ç›®æ ‡çš„çŠ¶æ€ï¼Œç”¨æˆ·äºŒæ¬¡å¼€å‘æ—¶å¯æ ¹æ®ä¸ŠæŠ¥çš„çŠ¶æ€è¿›è¡Œå¤„ç†ï¼Œæ›´å¿«çš„å®ç°è‡ªèº«ä¸šåŠ¡éœ€æ±‚ã€‚

> **æ³¨æ„ï¼š** æ­¤APIç›®å‰ä»…æ”¯æŒå¸¦æœ‰åç½®æ‘„åƒå¤´çš„è±¹å°ç§˜ï¼Œå…¶å®ƒæœºå™¨äººè¯·ä½¿ç”¨navigationå®ç°ç±»ä¼¼åŠŸèƒ½

### å¼€å§‹å¼•é¢†

**æ–¹æ³•åç§°ï¼š** `startLead`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
LeadingParams params = new LeadingParams();
//å¼•é¢†ç›®æ ‡äººid
params.setPersonId(personId);
//å¼•é¢†ç›®çš„åœ°
params.setDestinationName(dest);
//å¼•é¢†ç›®æ ‡æ‰¾ä¸åˆ°å¤šä¹…åä¸ŠæŠ¥ä¸¢å¤±çŠ¶æ€
params.setLostTimer(lostTime);
//å¼•é¢†å¼€å§‹å¤šä¹…åå¼€å¯äººè„¸è¯†åˆ«
params.setDetectDelay(delayTime);
//å¼•é¢†ç›®æ ‡è·ç¦»æœºå™¨äººå¤šè¿œåä¸ŠæŠ¥è¶…è·çŠ¶æ€
params.setMaxDistance(maxDistance);
RobotApi.getInstance().startLead(reqId, params, new ActionListener() {
    @Override
    public void onResult(int status, String responseString) throws RemoteException {
        switch (status) {
            case Definition.RESULT_OK:
                //æˆåŠŸå°†ç›®æ ‡å¼•é¢†åˆ°ç›®çš„åœ°
                break;
            case Definition.ACTION_RESPONSE_STOP_SUCCESS:
                //åœ¨å¼•é¢†æ‰§è¡Œä¸­ï¼Œä¸»åŠ¨è°ƒç”¨stopLeadï¼ŒæˆåŠŸåœæ­¢å¼•é¢†
                break;
            default:
                break;
        }
    }
    @Override
    public void onError(int errorCode, String errorString) throws RemoteException {
        switch (errorCode) {
            case Definition.ERROR_NOT_ESTIMATE:
                //å½“å‰æœªå®šä½
                break;
            case Definition.ERROR_SET_TRACK_FAILED:
            case Definition.ERROR_TARGET_NOT_FOUND:
                //å¼•é¢†ç›®æ ‡æœªæ‰¾åˆ°
                break;
            case Definition.ERROR_IN_DESTINATION:
                //å½“å‰å·²ç»åœ¨å¼•é¢†ç›®çš„åœ°
                break;
            case Definition.ERROR_DESTINATION_CAN_NOT_ARRAIVE:
                //é¿éšœè¶…æ—¶ï¼Œé»˜è®¤ä¸ºæœºå™¨äºº20sçš„å‰è¿›è·ç¦»ä¸è¶³0.1mï¼Œ
                break;
            case Definition.ERROR_DESTINATION_NOT_EXIST:
                //å¼•é¢†ç›®çš„åœ°ä¸å­˜åœ¨
                break;
            case Definition.ERROR_HEAD:
                //å¼•é¢†ä¸­æ“ä½œå¤´éƒ¨äº‘å°å¤±è´¥
                break;
            case Definition.ACTION_RESPONSE_ALREADY_RUN:
                //å¼•é¢†å·²ç»åœ¨è¿›è¡Œä¸­ï¼Œè¯·å…ˆåœæ­¢ä¸Šæ¬¡å¼•é¢†ï¼Œæ‰èƒ½é‡æ–°æ‰§è¡Œ
                break;
            case Definition.ACTION_RESPONSE_REQUEST_RES_ERROR:
                //å·²ç»æœ‰éœ€è¦æ§åˆ¶åº•ç›˜çš„æ¥å£è°ƒç”¨ï¼Œè¯·å…ˆåœæ­¢ï¼Œæ‰èƒ½ç»§ç»­è°ƒç”¨
                break;
            default:
                break;
        }
    }
    @Override
    public void onStatusUpdate(int status, String data) throws RemoteException {
        switch (status) {
            case Definition.STATUS_NAVI_OUT_MAP:
                //ç›®æ ‡ç‚¹ä¸èƒ½åˆ°è¾¾ï¼Œå¼•é¢†ç›®çš„åœ°åœ¨åœ°å›¾å¤–ï¼Œæœ‰å¯èƒ½ä¸ºåœ°å›¾ä¸ä½ç½®ç‚¹ä¸åŒ¹é…ï¼Œè¯·é‡æ–°è®¾ç½®ä½ç½®ç‚¹
                break;
            case Definition.STATUS_NAVI_AVOID:
                //å½“å‰å¼•é¢†è·¯çº¿å·²è¢«éšœç¢ç‰©å µæ­»
                break;
            case Definition.STATUS_NAVI_AVOID_END:
                //éšœç¢ç‰©å·²ç§»é™¤
                break;
            case Definition.STATUS_GUEST_FARAWAY:
                //å¼•é¢†ç›®æ ‡è·ç¦»æœºå™¨äººå¤ªè¿œï¼Œåˆ¤æ–­æ ‡å‡†é€šè¿‡å‚æ•°maxDistanceè®¾ç½®
                break;
            case Definition.STATUS_DEST_NEAR:
                //å¼•é¢†ç›®æ ‡è¿›å…¥æœºå™¨äººmaxDistanceèŒƒå›´å†…
                break;
            case Definition.STATUS_LEAD_NORMAL:
                //æ­£å¼å¼€å§‹å¯¼èˆª
                break;
            default:
                break;
        }
    }
});
```

### ç»“æŸå¼•é¢†

**æ–¹æ³•åç§°ï¼š** `stopLead`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().stopLead(reqId, isResetHW);
```

**å‚æ•°è¯´æ˜ï¼š**

- `isResetHW`ï¼šå¼•é¢†æ—¶ä¼šåˆ‡æ¢æ‘„åƒå¤´åˆ°åç½®æ‘„åƒå¤´ï¼Œ`isResetHW`æ˜¯ç”¨äºè®¾ç½®åœæ­¢å¼•é¢†æ—¶æ˜¯å¦æ¢å¤æ‘„åƒå¤´çŠ¶æ€
  - `true`ï¼šæ¢å¤æ‘„åƒå¤´ä¸ºå‰ç½®
  - `false`ï¼šä¿æŒåœæ­¢æ—¶çš„çŠ¶æ€
## ç„¦ç‚¹è·Ÿéš

### åœºæ™¯ä»‹ç»

ç„¦ç‚¹è·Ÿéšä¼šæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„äººè„¸idï¼ŒæŒç»­è¯†åˆ«å¹¶è·Ÿè¸ªï¼Œå¤´éƒ¨äº‘å°ä¼šæŒç»­è·Ÿç€ç›®æ ‡è½¬åŠ¨ï¼Œåº•ç›˜ä¹Ÿä¼šè·Ÿç€è”åŠ¨ï¼Œç›´åˆ°ç›®æ ‡é™æ­¢ï¼Œæœºå™¨äººæ­£å¯¹ç›®æ ‡ã€‚

### å¼€å¯ç„¦ç‚¹è·Ÿéš

**æ–¹æ³•åç§°ï¼š** `startFocusFollow`

> **æ³¨æ„1ï¼š** æ­¤æ–¹æ³•ä½¿ç”¨æ—¶ä¼šå ç”¨åº•ç›˜èµ„æºï¼Œä¸å¯åŒæ—¶æ‰§è¡Œä»»ä½•åº•ç›˜æ“ä½œï¼ŒåŒ…æ‹¬å¯¼èˆªã€‚
> 
> **æ³¨æ„2ï¼š** ä¸è¦åå¤è°ƒç”¨æ­¤æ–¹æ³•æ¥è·Ÿè¸ªåŒä¸€ä¸ªäººï¼Œåªéœ€è¦åœ¨è·Ÿéšä¸¢å¤±æˆ–ä¸»åŠ¨åœæ­¢è·Ÿéšåï¼Œå†æ¬¡å¯åŠ¨`startFocusFollow`ã€‚

**è°ƒç”¨æ–¹å¼ï¼š**

```java

RobotApi.getInstance().startFocusFollow(reqId, faceId, lostTimeout, maxDistance, new ActionListener() {
    @Override
    public void onStatusUpdate(int status, String data) {
        switch (status) {
            case Definition.STATUS_TRACK_TARGET_SUCCEED:
                //è·Ÿéšç›®æ ‡æˆåŠŸ
                break;
            case Definition.STATUS_GUEST_LOST:
                //è·Ÿéšç›®æ ‡ä¸¢å¤±
                break;
            case Definition.STATUS_GUEST_FARAWAY:
                //è·Ÿéšç›®æ ‡è·ç¦»å·²å¤§äºè®¾ç½®çš„æœ€å¤§è·ç¦»
                break;
            case Definition.STATUS_GUEST_APPEAR:
                //è·Ÿéšç›®æ ‡é‡æ–°è¿›å…¥è®¾ç½®çš„æœ€å¤§è·ç¦»å†…
                break;
        }
    }
    @Override public void onError(int errorCode, String errorString) {
        switch (errorCode) {
            case Definition.ERROR_SET_TRACK_FAILED:
            case Definition.ERROR_TARGET_NOT_FOUND:
                //è·Ÿéšç›®æ ‡æœªæ‰¾åˆ°
                break;
            case Definition.ACTION_RESPONSE_ALREADY_RUN:
                //æ­£åœ¨è·Ÿéšä¸­ï¼Œè¯·å…ˆåœæ­¢ä¸Šæ¬¡è·Ÿéšï¼Œæ‰èƒ½é‡æ–°æ‰§è¡Œ
                break;
            case Definition.ACTION_RESPONSE_REQUEST_RES_ERROR:
                //å·²ç»æœ‰éœ€è¦æ§åˆ¶åº•ç›˜çš„æ¥å£è°ƒç”¨(ä¾‹å¦‚ï¼šå¼•é¢†ã€å¯¼èˆª)ï¼Œè¯·å…ˆåœæ­¢ï¼Œæ‰èƒ½ç»§ç»­è°ƒç”¨
                break;
        }
    }
    @Override public void onResult(int status, String responseString) {
        Log.d(TAG, "startTrackPerson onResult status: " + status);
        switch (status) {
            case Definition.ACTION_RESPONSE_STOP_SUCCESS:
                //åœ¨ç„¦ç‚¹è·Ÿéšè¿‡ç¨‹ä¸­ï¼Œä¸»åŠ¨è°ƒç”¨stopFocusFollowï¼ŒæˆåŠŸåœæ­¢è·Ÿéš
                break;
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `faceId`ï¼šç„¦ç‚¹è·Ÿéšçš„ç›®æ ‡äººè„¸id
- `lostTimeout`ï¼šå¤šä¹…è¯†åˆ«ä¸åˆ°ç›®æ ‡ä¸ŠæŠ¥ç›®æ ‡ä¸¢å¤±çŠ¶æ€ï¼Œä¸€èˆ¬å¡«5-10ç§’
- `maxDistance`ï¼šç›®æ ‡è·ç¦»å¤šè¿œä¸ŠæŠ¥è¶…è·çŠ¶æ€ï¼Œä¸€èˆ¬å¡«5ç±³

### åœæ­¢ç„¦ç‚¹è·Ÿéš

**æ–¹æ³•åç§°ï¼š** `stopFocusFollow`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().stopFocusFollow(reqId);
```
## å”¤é†’

### åœºæ™¯ä»‹ç»

å”¤é†’åœºæ™¯æŒ‡æœºå™¨äººæ ¹æ®å”¤é†’è¯å‘¼å”¤çš„å£°æºæ–¹ä½ï¼Œæ§åˆ¶æœºå™¨äººè½¬åŠ¨åˆ°ç”¨æˆ·è§’åº¦ã€‚

**ä¸åŒæœºå‹ç­–ç•¥ï¼š**

- **å°ç§˜ç­–ç•¥**ï¼šå½“è§’åº¦å°äº45åº¦æ—¶ï¼Œåªè½¬åŠ¨å¤´éƒ¨äº‘å°ï¼Œå¤§äº45åº¦æ—¶ï¼Œå¤´éƒ¨äº‘å°åŠåº•ç›˜å‡ä¼šè½¬åŠ¨ï¼Œä»¥æœ€å¿«çš„é€Ÿåº¦è½¬åŠ¨åˆ°å£°æºå®šä½çš„ç›®æ ‡è§’åº¦
- **miniç­–ç•¥**ï¼šæ ¹æ®å£°æºæ–¹ä½ï¼Œè½¬åŠ¨åº•ç›˜åˆ°å£°æºæ–¹ä½

### å£°æºå®šä½

æ¯æ¬¡å”¤é†’æœºå™¨äººæ—¶ï¼Œå¯ä»¥è·å–åˆ°å”¤é†’æ—¶å”¤é†’äººå’Œæœºå™¨äººä¹‹é—´çš„å¤¹è§’ï¼Œè¿™ä¸ªå¤¹è§’å«å£°æºå®šä½è§’åº¦ã€‚åœ¨`ModuleCallback`çš„`onSendRequest`å›è°ƒè·å¾—ï¼Œ`reqType`ä¸º`Definition.REQ_SPEECH_WAKEUP`æ—¶ï¼Œ`reqParams`ä¸ºå£°æºå®šä½çš„è§’åº¦ã€‚å®ƒæ˜¯å”¤é†’APIçš„ä¼ å…¥å‚æ•°ã€‚

### å¼€å§‹å”¤é†’

**æ–¹æ³•åç§°ï¼š** `wakeUp`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().wakeUp(reqId, angle, new ActionListener() {
    @Override
    public void onResult(int status, String responseString) throws RemoteException {
        switch (status) {
            case Definition.RESULT_OK:
                //å”¤é†’å®Œæˆ
                break;
            case Definition.ACTION_RESPONSE_STOP_SUCCESS:
                //åœ¨å”¤é†’è¿‡ç¨‹ä¸­ï¼Œä¸»åŠ¨è°ƒç”¨stopWakeUpï¼Œåœæ­¢å”¤é†’
                break;
        }
    }
    @Override public void onError(int errorCode, String errorString) throws RemoteException {
        switch (errorCode) {
            case Definition.ERROR_MOVE_HEAD_FAILED:
                //å¤´éƒ¨äº‘å°ç§»åŠ¨å¤±è´¥
                break;
            case Definition.ACTION_RESPONSE_ALREADY_RUN:
                //å½“å‰æ­£åœ¨å”¤é†’ä¸­ï¼Œéœ€è¦å…ˆåœæ­¢ä¸Šæ¬¡å”¤é†’
                break;
            case Definition.ACTION_RESPONSE_REQUEST_RES_ERROR:
                //å·²ç»æœ‰éœ€è¦æ§åˆ¶åº•ç›˜çš„æ¥å£è°ƒç”¨(ä¾‹å¦‚ï¼šå¼•é¢†ã€å¯¼èˆªç­‰)ï¼Œè¯·å…ˆåœæ­¢ï¼Œæ‰èƒ½ç»§ç»­è°ƒç”¨
            break;
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `angle`ï¼šå£°æºå®šä½è§’åº¦

### åœæ­¢å”¤é†’

**æ–¹æ³•åç§°ï¼š** `stopWakeUp`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().stopWakeUp(reqId);
```

## ç”µé‡æ§åˆ¶

### è·å–å½“å‰ç”µé‡

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotSettingApi.getInstance().getRobotString(Definition.ROBOT_SETTINGS_BATTERY_INFO);
```

### å¼€å§‹è‡ªåŠ¨å›å……

**æ–¹æ³•åç§°ï¼š** `startNaviToAutoChargeAction`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().startNaviToAutoChargeAction(reqId, timeout, new ActionListener() {
    @Override
    public void onResult(int status, String responseString) throws RemoteException {
        switch (status) {
            case Definition.RESULT_OK:
                //å……ç”µæˆåŠŸ
                break;
            case Definition.RESULT_FAILURE:
                //å……ç”µå¤±è´¥
                break;
        }
    }
    @Override
    public void onStatusUpdate(int status, String data) throws RemoteException {
        switch (status) {
            case Definition.STATUS_NAVI_GLOBAL_PATH_FAILED:
                //å…¨å±€è·¯å¾„è§„åˆ’å¤±è´¥
                break;
            case Definition.STATUS_NAVI_OUT_MAP:
                //ç›®æ ‡ç‚¹ä¸èƒ½åˆ°è¾¾ï¼Œå¼•é¢†ç›®çš„åœ°åœ¨åœ°å›¾å¤–ï¼Œæœ‰å¯èƒ½ä¸ºåœ°å›¾ä¸ä½ç½®ç‚¹ä¸åŒ¹é…ï¼Œè¯·é‡æ–°è®¾ç½®ä½ç½®ç‚¹
                break;
            case Definition.STATUS_NAVI_AVOID:
                //å‰å¾€å›å……ç‚¹è·¯çº¿å·²è¢«éšœç¢ç‰©å µæ­»
                break;
            case Definition.STATUS_NAVI_AVOID_END:
                //éšœç¢ç‰©å·²ç§»é™¤
                break;
            default:
                break;
        }
    }
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `timeout`ï¼šå¯¼èˆªè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´æœªåˆ°è¾¾å……ç”µæ¡©ä½ç½®ï¼Œåˆ™è®¤ä¸ºå›å……å¤±è´¥

### ç»“æŸè‡ªåŠ¨å›å……

**æ–¹æ³•åç§°ï¼š** `stopAutoChargeAction`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().stopAutoChargeAction(reqId, true);
```
### åœæ­¢å……ç”µå¹¶è„±ç¦»å……ç”µæ¡©

**æ–¹æ³•åç§°ï¼š** `leaveChargingPile`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().leaveChargingPile(reqId, speed, distance, new CommandListener() {
            @Override
            public void onStatusUpdate(int status, String data, String extraData) {
                Log.d(TAG, "leaveChargingPile onStatusUpdate: " + status + " data:" + data + " extraData:" + extraData);
            }
            @Override
            public void onError(int errorCode, String errorString, String extraData) {
                Log.d(TAG, "leaveChargingPile errorCode: " + errorCode + " errorString:" + errorString + " extraData:" + extraData);
                switch (errorCode) {
                    case Definition.RESULT_FAILURE_MOTION_AVOID_STOP://å‰æ–¹æœ‰éšœç¢ï¼Œç¦»æ¡©å¤±è´¥
                        break;
                    case Definition.RESULT_FAILURE_TIMEOUT://ç¦»æ¡©è¶…æ—¶(15s)
                        break;
                    case Definition.STATUS_LEAVE_PILE_OPEN_RADAR_FAILURE://é›·è¾¾å¯åŠ¨å¤±è´¥
                        break;
                    default:
                        break;
                }
            }
            @Override
            public void onResult(int result, String message, String extraData) {
                Log.d(TAG, "leaveChargingPile onResult: " + result + " message:" + message);
                switch (result) {
                    case Definition.RESULT_OK://ç¦»æ¡©æˆåŠŸ
                        //å¦‚æœæ­¤å¤„æƒ³åˆ¤æ–­å……ç”µçŠ¶æ€ æ³¨æ„å……ç”µçŠ¶æ€æ›´æ–°ä¼šæœ‰ä¸€å®šæ—¶é—´
                        break;
                }
            }
        });
```

**å‚æ•°è¯´æ˜ï¼š**

- `speed`ï¼šç¦»æ¡©å‰è¿›çš„é€Ÿåº¦ï¼Œé»˜è®¤ 0.7
- `distance`ï¼šç¦»æ¡©å‰è¿›çš„è·ç¦»ï¼Œé»˜è®¤ 0.2ï¼Œå•ä½ç±³

> **å¤‡æ³¨1ï¼š** çº¿å……æ–¹å¼æ— æ³•ä½¿ç”¨è¯¥æ–¹æ³•è„±ç¦»å……ç”µã€‚
> 
> **å¤‡æ³¨2ï¼š** æ­¤æ–¹æ³•éœ€å…ˆè°ƒç”¨ `RobotApi.getInstance().disableBattery();` ç¦ç”¨ç³»ç»Ÿå……ç”µåæ‰èƒ½ä½¿ç”¨ã€‚


## å¤šæœºåä½œä¸è°ƒåº¦

### å¤šæœºåä½œ

å¤šæœºåä½œåŒ…å«å¤šæœºè°ƒåº¦å’Œå¤šæœºé¿è®©åŠŸèƒ½ï¼Œæ¶‰åŠåˆ°æœºå™¨äººå¤šæœºåä½œçš„åŸºç¡€èƒ½åŠ›ï¼Œæ­¤å¤„ä¸»è¦æ¶‰åŠåˆ°çš„é€šä¿¡æ¨¡å—ä¹Ÿå±äºæœºå™¨äººçš„å¤šæœºåä½œåŸºç¡€èƒ½åŠ›éƒ¨åˆ†ï¼Œæ‰€å±ç³»ç»ŸåŠŸèƒ½ã€‚

æœºå™¨äººå¤šæœºåä½œï¼Œä¸éœ€è¦æˆ‘ä»¬äººä¸ºåšä»»ä½•æ“ä½œï¼Œæ‰€æœ‰è¡Œä¸ºå‡æ˜¯æœºå™¨äººç³»ç»Ÿè°ƒåº¦ã€‚ä½†å‰ææ˜¯å¿…é¡»ä¿è¯æœºå™¨äººåœ¨åŒä¸€åœ°å›¾ä¸‹å·¥ä½œï¼Œå¤šä¸ªæœºå™¨äººåœ¨ç¢°é¢ä¹‹åï¼Œä¼šè°ƒç”¨æˆ‘ä»¬çš„æœºå™¨äººé€šä¿¡ï¼Œä¼šç»™ä»–ä»¬æ­¤æ—¶çš„å·¥ä½œä¼˜å…ˆçº§è¿›è¡Œæ’åºï¼Œä»è€Œæ¥ç¡®å®šæ˜¯é¿è®©è¿˜æ˜¯ç»§ç»­å·¥ä½œï¼Œä»è€Œé¿å…å¤šä¸ªæœºå™¨äººåœ¨å·¥ä½œæ—¶ç›¸é‡åœ¨åŒä¸€åœ°ç‚¹ï¼Œå‘†æ»ä¸åŠ¨çš„æƒ…å†µã€‚å› æ­¤ï¼Œåªéœ€ä¿è¯æœºå™¨äººæ€§èƒ½ä¸ç¡¬ä»¶ä¸€åˆ‡æ­£å¸¸ï¼Œå¤šæœºåä½œèƒ½åŠ›å³å¯æ­£å¸¸å·¥ä½œã€‚

### å¤šæœºåä½œä¿¡æ¯

åœ¨å®‰è£…äº†ESP32å¤šæœºé€šè®¯æ¨¡å—çš„æœºå™¨äººä¸Šï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è·å–å¤šæœºä¿¡æ¯ï¼Œå¯ç”¨äºåˆ¶ä½œå¤šæœºè°ƒåº¦ç³»ç»Ÿã€‚

> **æ³¨æ„ï¼š** ç›®å‰æ‹›è´¢è±¹ä¸€å®šæœ‰ESP32å¤šæœºé€šè®¯æ¨¡å—ï¼Œå…¶å®ƒæœºå™¨äººé»˜è®¤ä¸åŒ…å«è¿™ä¸ªæ¨¡å—ã€‚

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().registerStatusListener(Definition.STATUS_MULTIPLE_ROBOT_WORKING, mStatusListener);

private StatusListener mStatusListener = new StatusListener() {
    @Override
    public void onStatusUpdate(String type, String data) {
        try {
            Type dataType = new TypeToken<List<MultiRobotStatus>>(){}.getType();
            List<MultiRobotStatus> curRobotStatus = mGson.fromJson(data, dataType);
        } catch(Exception ex) {
            // å¤„ç†å¼‚å¸¸
        }
    }
};
```

**MultiRobotStatusç±»å®šä¹‰ï¼š**

```java
public class MultiRobotStatus {
    private BasePoseBean pose;
    private BasePoseBean goal;
    private int id;
    private int priority;
    private boolean mapMatch;
    private long time;
    private int status;
    private boolean curRobot = false;
    private int errorStatus = 0;
}
```

## ç³»ç»ŸåŠŸèƒ½

### ç³»ç»ŸçŠ¶æ€ç›‘æ§

æœºå™¨äººæœ‰éå¸¸å¤šçš„çŠ¶æ€ã€äº‹ä»¶å¯ä»¥ç›‘æ§ï¼Œæ¥è¾…åŠ©å®Œæˆå·¥ä½œã€‚ç›‘æ§ä¸»è¦ä½¿ç”¨ä¸‹é¢å‡½æ•°æ¥å®Œæˆã€‚

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().registerStatusListener(
        Definition.STATUS_POSE_ESTIMATE, mStatusPoseListener);
```

èƒ½ç›‘æ§åˆ°çš„äº‹ä»¶å®šä¹‰å¯ä»¥åœ¨SDKçš„`Definition.Java`ä¸­æ‰¾åˆ°ã€‚ç›®å‰æä¾›çš„ç›‘æ§çŠ¶æ€å¦‚ä¸‹ï¼š

```java
STATUS_POSE = "navi_pose"; //ä½ç½®æ”¹å˜
STATUS_MAP = "navi_map"; //åœ°å›¾æ”¹å˜
STATUS_EMERGENCY = "status_emergency"; //ç´§æ€¥çŠ¶æ€
STATUS_POSE_ESTIMATE = "status_pose_estimate"; //æœºå™¨äººå®šä½çŠ¶æ€
STATUS_AVOID_STOPPING = "status_avoid_stopping";//åŠ¨æ€é¿åœ
STATUS_SWITCH_MAP = "status_switch_map"; //åœ°å›¾åˆ‡æ¢
STATUS_RADAR = "status_radar"; //é›·è¾¾çŠ¶æ€
STATUS_BATTERY = "status_battery"; //ç”µæ± å……ç”µçŠ¶æ€
STATUS_MULTIPLE_ROBOT_WORKING = "status_multiple_robot_working"; //å¤šæœºçŠ¶æ€ä¿¡æ¯
STATUS_MAP_OUTSIDE = "status_map_outside_report"; //æœºå™¨å‡ºåœ°å›¾(ç›®å‰ä»…é™æ‹›è´¢)
STATUS_ROBOT_BEING_PUSHED = "status_robot_being_pushed"; //æœºå™¨è¢«æ¨åŠ¨(ç›®å‰ä»…é™æ‹›è´¢)
```
### è®¾ç½®ç¯æ•ˆ

**æ–¹æ³•åç§°ï¼š** `setLight`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
JSONObject params = new JSONObject();
try {
    params.put(Definition.JSON_LAMB_TYPE, type);
    params.put(Definition.JSON_LAMB_TARGET, 0);
    params.put(Definition.JSON_LAMB_RGB_START, startColor);
    params.put(Definition.JSON_LAMB_RGB_END, endColor);
    params.put(Definition.JSON_LAMB_START_TIME, startTime);
    params.put(Definition.JSON_LAMB_END_TIME, endTime);
    params.put(Definition.JSON_LAMB_REPEAT, loopTime);
    params.put(Definition.JSON_LAMB_ON_TIME, duration);
    params.put(Definition.JSON_LAMB_RGB_FREEZE, finalColor);
} catch (JSONException e) {
    e.printStackTrace();
}
RobotApi.getInstance().setLight(0, params.toString(), null);
```
**å‚æ•°è¯´æ˜ï¼š**

- `reqId`ï¼šintç±»å‹ï¼Œå‘½ä»¤id
- `params`ï¼šStringç±»å‹ï¼Œå¯åŒ…å«å¦‚ä¸‹å‚æ•°ï¼š
  - `type`ï¼šå¡«0
  - `startColor`ï¼šç¯æ•ˆèµ·å§‹é¢œè‰²å€¼
  - `endColor`ï¼šç¯æ•ˆç»“æŸé¢œè‰²å€¼
  - `startTime`ï¼šæ¸å˜å¼€å§‹é¢œè‰²åœç•™çš„æ—¶é—´
  - `endTime`ï¼šæ¸å˜ç»“æŸé¢œè‰²åœç•™çš„æ—¶é—´
  - `loopTime`ï¼šç¯æ•ˆæ¸å˜é‡å¤æ¬¡æ•°
  - `duration`ï¼šæ¸å˜è¿‡ç¨‹èŠ±è´¹çš„æ—¶é—´
  - `finalColor`ï¼šæ¸å˜è¿‡æ¸¡é¢œè‰²
- `listener`ï¼šActionListenerç±»å‹ï¼Œæ¶ˆæ¯å›è°ƒ

> **æ³¨æ„ï¼š** é¢œè‰²å€¼ä½¿ç”¨RGBæ’åˆ—çš„16ä½å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚"F3F3F3"æˆ–è€…"00FF00"ã€‚

**è¿”å›å€¼ï¼š**

- `int result`ï¼š0 å‘½ä»¤æ‰§è¡Œ / -1 æ²¡æœ‰æ‰§è¡Œ

> **ç¤ºä¾‹ä»£ç ï¼š** è®¾ç½®ç¯æ•ˆä»£ç demoå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼ˆä»£ç é€‚ç”¨äºè±¹å°ç§˜æœºå™¨äººï¼Œå…¶ä»–æœºå™¨äººè¯·æ›¿æ¢æœºå™¨äººjaråŒ…ï¼‰ï¼šç‚¹å‡»è¿™é‡Œ

### æ‹›è´¢è±¹Proå’Œè±¹å°é€’Proè®¾ç½®ç¯æ•ˆ

#### æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ProZcbLedç¯å¸¦æ¥å£

**æ–¹æ³•åç§°ï¼š** `isUseProZcbLed`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
/**
 * æ˜¯å¦ä½¿ç”¨ProZcbLedç¯å¸¦æ¥å£
 */
RobotApi.getInstance().isUseProZcbLed();
```

#### è®¾ç½®åº•ç›˜ç¯å¸¦æ•ˆæœ

**æ–¹æ³•åç§°ï¼š** `setProZcbLedEffect`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
/**
 * æ§åˆ¶ZcbLedç¯ï¼Œå³Saiph Proçš„åº•ç›˜ç¯å¸¦
 * proZcbEffect å‚æ•°å‚è€ƒä¸‹é¢é¢œè‰²å®šä¹‰
 * Zcb:æ‹›è´¢è±¹
 */
RobotApi.getInstance().setProZcbLedEffect(int reqId, int proZcbEffect, CommandListener listener);
```

#### æ£€æŸ¥æ˜¯å¦æœ‰é”éª¨ç¯

**æ–¹æ³•åç§°ï¼š** `isHasClavicleLight`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
/**
 * æ˜¯å¦æœ‰é”éª¨ç¯
 */
RobotApi.getInstance().isHasClavicleLight();
```

#### è®¾ç½®é”éª¨ç¯æ•ˆæœ

**æ–¹æ³•åç§°ï¼š** `setProIobLedEffect`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
/**
 * æ§åˆ¶IobLedç¯ï¼Œå³Saiph Proçš„é”éª¨ç¯
 * proIobLedEffect å‚æ•°å‚è€ƒä¸‹é¢é¢œè‰²å®šä¹‰
 * "Iob"åº”è¯¥æ˜¯æ‹¼å†™é”™è¯¯ï¼Œåº”è¯¥æ˜¯Lobbyï¼Œè¡¨ç¤ºèƒ¸å£éƒ¨ä½çš„ç¯å¸¦ã€‚
 */
RobotApi.getInstance().setProIobLedEffect(int reqId, int proIobLedEffect, CommandListener listener);
```
#### é¢œè‰²å®šä¹‰

```java
public static final int ZCB2UARTLED_GREENBREATH = 0xDE10;  //ç»¿è‰²å‘¼å¸æ•ˆæœ
public static final int ZCB2UARTLED_BLUEBREATH = 0xDE11;  //è“è‰²å‘¼å¸æ•ˆæœ
public static final int ZCB2UARTLED_ORANGEBREATH = 0xDE12;  //æ©™è‰²å‘¼å¸æ•ˆæœ
public static final int ZCB2UARTLED_YELLOWBREATH = 0xDE13;  //é»„è‰²å‘¼å¸æ•ˆæœ
public static final int ZCB2UARTLED_BLUENORMAL = 0xDE14;  //è“è‰²æ­£å¸¸æ•ˆæœ
public static final int ZCB2UARTLED_REDNORMAL = 0xDE15;  //çº¢è‰²æ­£å¸¸æ•ˆæœ
public static final int ZCB2UARTLED_ORANGENORMAL = 0xDE16;  //æ©™è‰²æ­£å¸¸æ•ˆæœ
public static final int ZCB2UARTLED_YELLOWNORMAL = 0xDE17;  //é»„è‰²æ­£å¸¸æ•ˆæœ
public static final int ZCB2UARTLED_GREENNORMAL = 0xDE18;  //ç»¿è‰²æ­£å¸¸æ•ˆæœ
public static final int ZCB2UARTLED_TURNRIGHT = 0xDE19;  //å³è½¬æ•ˆæœ
public static final int ZCB2UARTLED_TURNLEFT = 0xDE20;  //å·¦è½¬æ•ˆæœ
public static final int ZCB2UARTLED_REGFLASH = 0xDE21;  //çº¢è‰²é—ªæ•ˆæœ
public static final int ZCB2UARTLED_YELLOWFLASH = 0xDE22;  //é»„è‰²é—ªæ•ˆæœ
public static final int ZCB2UARTLED_ALLOFF = 0xDE00;  //å…³é—­æ‰€æœ‰zcbæ•ˆæœ
```
è·å–æœ¬æœºSN

**æ–¹æ³•åç§°ï¼š** `getRobotSn`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
boolean status = RobotApi.getInstance().getRobotSn(
    new CommandListener(){
        @Override
        public void onResult(int result, String message) {
            if (Definition.RESULT_OK == result) {
                String serialNum = message;
            } else {
                // å¤„ç†é”™è¯¯
            }
        }
    });
```

**å‚æ•°è¯´æ˜ï¼š**

- `listener`ï¼šCommandListener æ¶ˆæ¯å›è°ƒ{"code":0, "message":"err msg"}

**è¿”å›å€¼ï¼š**

- `int result`ï¼š1 å‘½ä»¤æ‰§è¡Œ / -1 æ²¡æœ‰æ‰§è¡Œ

---

### è·å–ç³»ç»Ÿç‰ˆæœ¬

**æ–¹æ³•åç§°ï¼š** `getVersion`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
String version = RobotApi.getInstance().getVersion();
```

---

### ç¦æ­¢ç³»ç»ŸåŠŸèƒ½

ç³»ç»Ÿä¸å†æ¥ç®¡æ€¥åœäº‹ä»¶ï¼Œæ²¡æœ‰æ€¥åœç”»é¢ï¼Œå¯ç”¨äºç”¨æˆ·è‡ªå®šä¹‰æ€¥åœç”»é¢ã€‚åœ¨æ€¥åœçŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰åº•ç›˜ç›¸å…³åŠŸèƒ½APIä¸å¯ä½¿ç”¨ï¼Œå”¤é†’ã€ä¼‘çœ ç­‰åˆ‡æ¢æœºå™¨äººçŠ¶æ€çš„APIä¹Ÿä¸ç”Ÿæ•ˆã€‚

**æ–¹æ³•åç§°ï¼š** `disableEmergency`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().disableEmergency();
```

**è·å–EmergencyçŠ¶æ€çš„APIï¼š**

```java
RobotApi.getInstance().getRobotStatus(Definition.STATUS_EMERGENCY, new StatusListener(){
    @Override
    public void onStatusUpdate(String type, String data) throws RemoteException {
        Log.d("onStatusUpdate","Status:"+data);
    }
});

// æˆ–è€…ä½¿ç”¨ä¸‹é¢æ–¹æ³•æ³¨å†Œæ€¥åœçŠ¶æ€äº‹ä»¶
RobotApi.getInstance().registerStatusListener(Definition.STATUS_EMERGENCY, new StatusListener(){
    @Override
    public void onStatusUpdate(String type, String data) throws RemoteException {
        Log.d("onStatusUpdate","status:"+type+";value:"+data);
    }
});
```

---

### ç¦ç”¨ç”µæ± ç•Œé¢

ç¦ç”¨å½“å‰ç”µæ± ç•Œé¢ï¼Œå……ç”µæ—¶å¯ä½¿ç”¨é™¤åº•ç›˜å¤–client appä»»ä½•èƒ½åŠ›ã€‚

å¦‚æœç¡®è®¤ä¸éœ€è¦å……ç”µæ¥ç®¡ï¼Œæ¨èåœ¨APPå¯åŠ¨è¿ä¸ŠRobotAPIæˆåŠŸä¹‹åï¼Œç›´æ¥è°ƒç”¨æ­¤æ¥å£ç¦ç”¨ã€‚æ­¤åç›´åˆ°APPé€€å‡ºï¼Œå……ç”µæ¥ç®¡ç”»é¢éƒ½ä¼šå¤„äºç¦ç”¨çŠ¶æ€ã€‚

**æ–¹æ³•åç§°ï¼š** `disableBattery`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().disableBattery();
```

**è·å–BatteryçŠ¶æ€çš„APIï¼š**

```java
RobotSettingApi.getInstance().getRobotString(Definition.ROBOT_SETTINGS_BATTERY_INFO);

// æˆ–ä½¿ç”¨ä¸‹é¢æ–¹æ³•ç›‘å¬ç”µæ± çŠ¶æ€å˜åŒ–
RobotApi.getInstance().registerStatusListener(Definition.STATUS_BATTERY, listener);
```

---

### ç¦ç”¨åŠŸèƒ½é”®

ç¦ç”¨åŠŸèƒ½é”®ï¼Œæ‹›è´¢è±¹å¤´éƒ¨åé¢æŒ‰é’®ã€‚

**æ–¹æ³•åç§°ï¼š** `disableFunctionKey`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().disableFunctionKey();
```

---

### ä¼‘çœ åŠŸèƒ½

#### åœºæ™¯ä»‹ç»

ä¼‘çœ æ˜¯è®©æœºå™¨äººåœ¨æ²¡æœ‰ä»»åŠ¡æˆ–è€…ä½ç”µé‡çš„æ—¶å€™ï¼Œä¿æŒä½åŠŸè€—è¿è¡Œçš„ä¸€ç§æ¨¡å¼ã€‚

> **æ³¨æ„ï¼š** ä½¿ç”¨ä¼‘çœ APIéœ€è¦æ·»åŠ å¦‚ä¸‹æƒé™ï¼š
> ```xml
> <uses-permission android:name="com.ainirobot.coreservice.robotSettingProvider" />
> ```

#### å¼€å§‹ä¼‘çœ 

**æ–¹æ³•åç§°ï¼š** `robotStandby`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().robotStandby(0, new CommandListener() {
    @Override
    public void onStatusUpdate(int status, String data, String extraData) {
        super.onStatusUpdate(status, data, extraData);
    }
});
```

#### åœæ­¢ä¼‘çœ 

**æ–¹æ³•åç§°ï¼š** `robotStandbyEnd`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().robotStandbyEnd(reqId);
```

---

### å®‰è£…APK

**æ–¹æ³•åç§°ï¼š** `installApk`

**è°ƒç”¨æ–¹å¼ï¼š**

```java
RobotApi.getInstance().installApk(reqid, fullPathName, taskID);
```

**å‚æ•°è¯´æ˜ï¼š**

- `reqId`ï¼šintç±»å‹ï¼Œå‘½ä»¤id
- `fullPathName`ï¼šå®‰è£…åŒ…è·¯å¾„
- `taskID`ï¼štaskIDï¼Œéç©ºçš„ä»»æ„å­—ç¬¦ä¸²å†…å®¹
